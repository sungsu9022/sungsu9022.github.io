<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="[스파크 완벽 가이드] 10. 스파크 SQL" /><meta name="author" content="sungsu park" /><meta property="og:locale" content="en" /><meta name="description" content="[스파크 완벽 가이드] 10. 스파크 SQL 10.1 SQL이란 SQL 또는 구조적 질의 언어(Structured Query Langauge)는 데이터에 대한 관계형 연산을 표현하기 위한 도메인 특화언어 스파크에서는 NoSQL DB에서도 쉽게 사용할 수 있는 변형된 자체 SQL을 제공합니다. 스파크에서는 ANSI SQL 2003의 일부도 구현함." /><meta property="og:description" content="[스파크 완벽 가이드] 10. 스파크 SQL 10.1 SQL이란 SQL 또는 구조적 질의 언어(Structured Query Langauge)는 데이터에 대한 관계형 연산을 표현하기 위한 도메인 특화언어 스파크에서는 NoSQL DB에서도 쉽게 사용할 수 있는 변형된 자체 SQL을 제공합니다. 스파크에서는 ANSI SQL 2003의 일부도 구현함." /><link rel="canonical" href="https://sungsu9022.github.io/posts/spark-guide-10/" /><meta property="og:url" content="https://sungsu9022.github.io/posts/spark-guide-10/" /><meta property="og:site_name" content="Sungsu’s Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-31T17:02:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[스파크 완벽 가이드] 10. 스파크 SQL" /><meta name="twitter:site" content="@sungsu9022dev" /><meta name="twitter:creator" content="@sungsu park" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"sungsu park"},"dateModified":"2022-12-31T17:02:00+09:00","datePublished":"2022-12-31T17:02:00+09:00","description":"[스파크 완벽 가이드] 10. 스파크 SQL 10.1 SQL이란 SQL 또는 구조적 질의 언어(Structured Query Langauge)는 데이터에 대한 관계형 연산을 표현하기 위한 도메인 특화언어 스파크에서는 NoSQL DB에서도 쉽게 사용할 수 있는 변형된 자체 SQL을 제공합니다. 스파크에서는 ANSI SQL 2003의 일부도 구현함.","headline":"[스파크 완벽 가이드] 10. 스파크 SQL","mainEntityOfPage":{"@type":"WebPage","@id":"https://sungsu9022.github.io/posts/spark-guide-10/"},"url":"https://sungsu9022.github.io/posts/spark-guide-10/"}</script><title>[스파크 완벽 가이드] 10. 스파크 SQL | Sungsu's Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sungsu's Tech Blog"><meta name="application-name" content="Sungsu's Tech Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/personal/sunny.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Sungsu's Tech Blog</a></div><div class="site-subtitle font-italic">Java/Kotlin Spring, Back-end</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/sungsu9022" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/sungsu9022dev" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['sungsu9022','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[스파크 완벽 가이드] 10. 스파크 SQL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[스파크 완벽 가이드] 10. 스파크 SQL</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1672473720" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 31, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3841 words"> <em>21 min</em> read</span></div></div></div><div class="post-content"><h1 id="스파크-완벽-가이드-10-스파크-sql">[스파크 완벽 가이드] 10. 스파크 SQL</h1><h2 id="101-sql이란"><span class="mr-2">10.1 SQL이란</span><a href="#101-sql이란" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>SQL 또는 구조적 질의 언어(Structured Query Langauge)는 데이터에 대한 관계형 연산을 표현하기 위한 도메인 특화언어<li>스파크에서는 NoSQL DB에서도 쉽게 사용할 수 있는 변형된 자체 SQL을 제공합니다.<li>스파크에서는 ANSI SQL 2003의 일부도 구현함.</ul><h2 id="102-빅데이터와-sql--아파치-하이브"><span class="mr-2">10.2 빅데이터와 SQL : 아파치 하이브</span><a href="#102-빅데이터와-sql--아파치-하이브" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>스파크가 등장하기 전에는 Hive가 빅데이터 SQL 접근 계층에서 사실상 표준이었음.<li>현재는 많은 사용자가 스파크 SQL을 사용함.</ul><h2 id="103-빅데이터와-sql--스파크-sql"><span class="mr-2">10.3 빅데이터와 SQL : 스파크 SQL</span><a href="#103-빅데이터와-sql--스파크-sql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>스파크 2.0 버전에는 하이브를 지원할 수 있는 상위 호환 기능으로 ANSI-SQL과 HiveSL을 모두 지원하는 자체 개발된 SQL 파서가 포함되어 있음.<li>기존 하이브 기반 파이프라인에 비해 엄청난 성능 개선(4.5~6배 CPU 성능 개선, 3~4배의 자원 예약 개선, 최대 5배의 지연 시간 감소)를 만들어 냈음.</ul><h3 id="1031-스파크와-하이브의-관계"><span class="mr-2">10.3.1 스파크와 하이브의 관계</span><a href="#1031-스파크와-하이브의-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>스파크 SQL은 하이브 메타스토어를 사용하므로 하이브와 잘 연동할 수 있다.<ul><li>하이브 메타스토어는 여러 세션에서 사용할 테이블 정보를 보관.<li>스파크 SQL은 메타스토어에 접속하여 조회할 파일 수를 최소화 하기 위해 참조함.</ul></ul><h4 id="하이브-메타스토어"><span class="mr-2">하이브 메타스토어</span><a href="#하이브-메타스토어" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>스파크에서 <code class="language-plaintext highlighter-rouge">spark.sql.hive.metastore.version</code> 설정을 통해 접근 가능.<li>HiveMetastoreClient 초기화 방식 변경을 위해서는 <code class="language-plaintext highlighter-rouge">spark.sql.hive.metastore.jars</code>을 변경해서 처리 가능</ul><h2 id="104-스파크-sql-쿼리-실행-방법"><span class="mr-2">10.4 스파크 SQL 쿼리 실행 방법</span><a href="#104-스파크-sql-쿼리-실행-방법" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="1041-스파크-sql-cli"><span class="mr-2">10.4.1 스파크 SQL CLI</span><a href="#1041-스파크-sql-cli" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>로컬 환경의 CLI에서 스파크 SQL 쿼리를 해볼수 있는 편리한 도구</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./bin/spark-sql
</pre></table></code></div></div><h3 id="1042-스파크의--프로그래밍-sql-인터페이스"><span class="mr-2">10.4.2 스파크의 프로그래밍 SQL 인터페이스</span><a href="#1042-스파크의--프로그래밍-sql-인터페이스" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>서버를 설정해 SQl을 사용할수 있지만, 스파크에서 지원하는 언어 APi로 비정형 SQL을 실행할 수 있음.<li><code class="language-plaintext highlighter-rouge">SparkSession</code> 객체의 sql 메서드를 사용.</ul><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">spark</span><span class="o">.</span><span class="py">sql</span><span class="o">(</span><span class="s">"SELECT 1 + 1"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>

<span class="nv">spark</span><span class="o">.</span><span class="py">sql</span><span class="o">(</span><span class="s">"""
SELECT DEST_COUNTRY_NAME, sum(count)
FROM some_sql_view GROUP BY DEST_COUNTRY_NAME
"""</span><span class="o">)</span>
  <span class="o">.</span><span class="py">where</span><span class="o">(</span><span class="s">"DEST_COUNTRY_NAME like 'S%'"</span><span class="o">).</span><span class="py">where</span><span class="o">(</span><span class="s">"`sum(count)` &gt; 10"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">count</span><span class="o">()</span> <span class="c1">// SQL =&gt; DF</span>
</pre></table></code></div></div><ul><li>쿼리 명령을 수행하면 프로그래밍 방식으로 평가할 수 있는 DataFrame을 반환함.<li>스파크SQL도 마찬가지로 즉시 실행되는것이 아니라 지연처리됨.<li>SQL과 DataFrame은 완벽히 연동 가능함.<ul><li>DataFrame을 생성하고 SQl을 사용해 처리하고 그 결과를 다시 DataFrame으로 받을수 있음.</ul></ul><h3 id="1043-스파크-sql-쓰리프트-jdbcodbc-서버"><span class="mr-2">10.4.3 스파크 SQL, 쓰리프트 JDBC/ODBC 서버</span><a href="#1043-스파크-sql-쓰리프트-jdbcodbc-서버" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>스파크는 자바 DB 연결(JDBC) 인터페이스를 제공함.<li>비즈니스 분석가가 태블로 같은 BI 소프트웨어를 이용해 스파크에 접속하는 혀애가 대표적인 케이스<li>쓰리프트 JDBC/oDBC 서버는 하이브 1.2.1 버전의 HiveServer2에 맞추어 구현되어있음.</ul><h2 id="105-카탈로그"><span class="mr-2">10.5 카탈로그</span><a href="#105-카탈로그" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>스파크 SQL에서 가장 높은 추상화 단계는 카탈로그입니다.<li>테이블에 저장된 데이터의 메타데이터 뿐만 아니라 DB, Table, Function, View에 대한 정보를 추상화<li><code class="language-plaintext highlighter-rouge">org.apache.spark.sql.catelog.Catalog</code> 패키지로 사용</ul><h2 id="106-테이블"><span class="mr-2">10.6 테이블</span><a href="#106-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>스파크 SQL을 사용해 작업을 수행하려면 먼저 테이블을 정의해야함.<li>DataFrame과 논리적으로 동일함.<li>조인, 필터링, 집계 등 여러 데이터 변환 작업을 수행할 수 있다.<li>DatFrame은 프로그래밍 언어 레벨에서 정의할수 있으나, 테이블은 데이터베이스상에 정의해야 함.</ul><h3 id="1061-스파크-관리형-테이블"><span class="mr-2">10.6.1 스파크 관리형 테이블</span><a href="#1061-스파크-관리형-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>관리형 테이블과 외부 테이블 개념을 기억해야 함.</ul><h4 id="외부-테이블"><span class="mr-2">외부 테이블</span><a href="#외부-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>디스크에 저장된 파일을 용해서 테이블을 정의하는 경우 해당됨.</ul><h4 id="관리형-테이블"><span class="mr-2">관리형 테이블</span><a href="#관리형-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>DataFrame의 <code class="language-plaintext highlighter-rouge">saveAsTable</code> 메서드를 이용해서 스파크가 관련된 모든 정보를 추적할 수 있는 관리형 테이블을 만들수 있음.</ul><h3 id="1062-테이블-생성하기"><span class="mr-2">10.6.2 테이블 생성하기</span><a href="#1062-테이블-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>다양한 데이터 소스를 사용해 테이블을 생성할 수 있음.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">flights</span> <span class="p">(</span>
  <span class="n">DEST_COUNTRY_NAME</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">ORIGIN_COUNTRY_NAME</span> <span class="n">STRING</span><span class="p">,</span> <span class="k">count</span> <span class="n">LONG</span><span class="p">)</span>
<span class="k">USING</span> <span class="n">JSON</span> <span class="k">OPTIONS</span> <span class="p">(</span><span class="n">path</span> <span class="s1">'/data/flight-data/json/2015-summary.json'</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="using과-stored-as-구문"><span class="mr-2"><code class="language-plaintext highlighter-rouge">USING</code>과 <code class="language-plaintext highlighter-rouge">STORED AS</code> 구문</span><a href="#using과-stored-as-구문" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><code class="language-plaintext highlighter-rouge">USING</code> 구문은 매우 중요함. 포맷을 지정하지 않으면 기본적으로 하이브 SerDe설정을 사용한다.<ul><li>하이브의 SerDe는 스파크의 자체 직렬화보다 훨씬 느리므로 테이블을 사용하는 Reader, Writer성능에 영향을 미칠 수 있음.</ul><li>하이브 사용자는 <code class="language-plaintext highlighter-rouge">STORED AS</code> 구문을 통해 하이브 테이블을 생성할 수 있음.</ul><h4 id="comment"><span class="mr-2">COMMENT</span><a href="#comment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">flights_csv</span> <span class="p">(</span>
  <span class="n">DEST_COUNTRY_NAME</span> <span class="n">STRING</span><span class="p">,</span>
  <span class="n">ORIGIN_COUNTRY_NAME</span> <span class="n">STRING</span> <span class="k">COMMENT</span> <span class="nv">"remember, the US will be most prevalent"</span><span class="p">,</span>
  <span class="k">count</span> <span class="n">LONG</span><span class="p">)</span>
<span class="k">USING</span> <span class="n">csv</span> <span class="k">OPTIONS</span> <span class="p">(</span><span class="n">header</span> <span class="k">true</span><span class="p">,</span> <span class="n">path</span> <span class="s1">'/data/flight-data/csv/2015-summary.csv'</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="create-table-from-select"><span class="mr-2">CREATE TABLE FROM SELECT</span><a href="#create-table-from-select" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">flights_from_select</span> <span class="k">USING</span> <span class="n">parquet</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
</pre></table></code></div></div><h4 id="테이블이-없는-경우에만-생성"><span class="mr-2">테이블이 없는 경우에만 생성</span><a href="#테이블이-없는-경우에만-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">flights_from_select</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
</pre></table></code></div></div><h4 id="파티셔닝된-데이터셋을-저장해-데이터-레이아웃을-제어"><span class="mr-2">파티셔닝된 데이터셋을 저장해 데이터 레이아웃을 제어</span><a href="#파티셔닝된-데이터셋을-저장해-데이터-레이아웃을-제어" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">partitioned_flights</span> <span class="k">USING</span> <span class="n">parquet</span> <span class="n">PARTITIONED</span> <span class="k">BY</span> <span class="p">(</span><span class="n">DEST_COUNTRY_NAME</span><span class="p">)</span>
<span class="k">AS</span> <span class="k">SELECT</span> <span class="n">DEST_COUNTRY_NAME</span><span class="p">,</span> <span class="n">ORIGIN_COUNTRY_NAME</span><span class="p">,</span> <span class="k">count</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">LIMIT</span> <span class="mi">5</span>
</pre></table></code></div></div><h3 id="1063-외부-테이블-생성하기"><span class="mr-2">10.6.3 외부 테이블 생성하기</span><a href="#1063-외부-테이블-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>스파크 SQL은 초기 빅데이터 SQL시스템 중 하나인 하이브 SQl과 완벽하게 호환됨.<li>기존 하이브 쿼리문을 스파크 SQL로 변환해야 하는 경우 대부분 문제없이 바로 사용할수 있음.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">hive_flights</span> <span class="p">(</span>
  <span class="n">DEST_COUNTRY_NAME</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">ORIGIN_COUNTRY_NAME</span> <span class="n">STRING</span><span class="p">,</span> <span class="k">count</span> <span class="n">LONG</span><span class="p">)</span>
<span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span> <span class="k">LOCATION</span> <span class="s1">'/data/flight-data-hive/'</span>
</pre></table></code></div></div><h4 id="select로부터-생성"><span class="mr-2">SELECT로부터 생성</span><a href="#select로부터-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">hive_flights_2</span>
<span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span>
<span class="k">LOCATION</span> <span class="s1">'/data/flight-data-hive/'</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
</pre></table></code></div></div><h3 id="1064-테이블에-데이터-삽입하기"><span class="mr-2">10.6.4 테이블에 데이터 삽입하기</span><a href="#1064-테이블에-데이터-삽입하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>표준 SQL 문법을 따름.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">flights_from_select</span>
    <span class="k">SELECT</span> <span class="n">DEST_COUNTRY_NAME</span><span class="p">,</span> <span class="n">ORIGIN_COUNTRY_NAME</span><span class="p">,</span> <span class="k">count</span>
    <span class="k">FROM</span> <span class="n">flights</span>
    <span class="k">LIMIT</span> <span class="mi">20</span>
</pre></table></code></div></div><h4 id="특정-파티션에만-저장하고-싶은-경우"><span class="mr-2">특정 파티션에만 저장하고 싶은 경우</span><a href="#특정-파티션에만-저장하고-싶은-경우" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>파티션 명세 추가하여 가능.<li>쓰기 연산은 파티셔닝 스키마에 맞게 데이터를 저장</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">partitioned_flights</span>
  <span class="k">PARTITION</span> <span class="p">(</span><span class="n">DEST_COUNTRY_NAME</span><span class="o">=</span><span class="nv">"UNITED STATES"</span><span class="p">)</span>
  <span class="k">SELECT</span> <span class="k">count</span><span class="p">,</span> <span class="n">ORIGIN_COUNTRY_NAME</span> <span class="k">FROM</span> <span class="n">flights</span>
  <span class="k">WHERE</span> <span class="n">DEST_COUNTRY_NAME</span><span class="o">=</span><span class="s1">'UNITED STATES'</span> <span class="k">LIMIT</span> <span class="mi">12</span>
</pre></table></code></div></div><h3 id="1065-테이블-메타데이터-확인"><span class="mr-2">10.6.5 테이블 메타데이터 확인</span><a href="#1065-테이블-메타데이터-확인" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">DESCRIBE</span> <span class="k">TABLE</span> <span class="n">flights_csv</span>

<span class="o">//</span> <span class="err">파티셔닝</span> <span class="err">스키마</span> <span class="err">정보</span> <span class="err">확인</span>
<span class="k">SHOW</span> <span class="n">PARTITIONS</span> <span class="n">partitioned_flights</span>
</pre></table></code></div></div><h3 id="1066-테이블-메타데이터-갱신하기"><span class="mr-2">10.6.6 테이블 메타데이터 갱신하기</span><a href="#1066-테이블-메타데이터-갱신하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>테이블 메타데이터를 유지하는 것은 가장 최신의 데이터셋을 읽고 있다는 것을 보장할 수 있는 중요한 작업.<li>테이블 메타데이터를 갱신할 수 있는 2가지 명령이 있다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">-- 테이블과 관련된 모든 캐싱된 항목(기본적으로 파일) 갱신</span>
<span class="n">REFRESH</span> <span class="k">table</span> <span class="n">partitioned_flights</span>

<span class="c1">-- 카탈로그에서 관리하는 테이블의 파티션 정보를 새로고침.</span>
<span class="n">MSCK</span> <span class="n">REPAIR</span> <span class="k">TABLE</span> <span class="n">partitioned_flights</span>
</pre></table></code></div></div><h3 id="1067-테이블-제거하기"><span class="mr-2">10.6.7 테이블 제거하기</span><a href="#1067-테이블-제거하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>테이블은 삭제(<code class="language-plaintext highlighter-rouge">DELETE</code>)할 수 없음.<li>오로지 제거(<code class="language-plaintext highlighter-rouge">DROP</code>)맘ㄴ 가능.<li>관리형 테이블의 경우 제거하면 데이터와 테이블 정의 모두 제거 됨.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">flights_csv</span><span class="p">;</span>

<span class="c1">-- 존재하는 경우에만 제거</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">flights_csv</span><span class="p">;</span>
</pre></table></code></div></div><h4 id="외부-테이블-제거"><span class="mr-2">외부 테이블 제거</span><a href="#외부-테이블-제거" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>외부 테이블을 제거하면 데이터는 삭제되지 않지만, 외부 테이블명을 통해 데이터를 조회할 수 없음.</ul><h3 id="1068-테이블-캐싱하기"><span class="mr-2">10.6.8 테이블 캐싱하기</span><a href="#1068-테이블-캐싱하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>DataFrame에서처럼 테이블을 캐시하거나 캐시에서 제거할 수 있다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">-- 캐시</span>
<span class="k">CACHE</span> <span class="k">TABLE</span> <span class="n">flights</span>

<span class="c1">-- 캐시 제거</span>
<span class="n">UNCACHE</span> <span class="k">TABLE</span> <span class="n">FLIGHTS</span>
</pre></table></code></div></div><h2 id="107-뷰"><span class="mr-2">10.7 뷰</span><a href="#107-뷰" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>뷰는 기준 테이블에서 여러 트랜스포메이션 작업을 지정하여 정의<li>기본적으로 뷰는 단순 쿼리 실행 계획일 뿐이다.<li>뷰를 사용하면 쿼리 로직을 체계화하거나 재사용하기 편하게 만들수 있다.</ul><h3 id="1071-뷰-생성하기"><span class="mr-2">10.7.1 뷰 생성하기</span><a href="#1071-뷰-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">-- 테이블처럼 데이터베이스에 등록한 뷰 생성</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">just_usa_view</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">dest_country_name</span> <span class="o">=</span> <span class="s1">'United States'</span>

<span class="c1">-- 데이터베이스에 등록되지 않고, 현재 세션에서만 사용할 수 있는 임시 뷰 생성</span>
<span class="k">CREATE</span> <span class="k">TEMP</span> <span class="k">VIEW</span> <span class="n">just_usa_view_temp</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">dest_country_name</span> <span class="o">=</span> <span class="s1">'United States'</span>

<span class="c1">--  전역적 임시 뷰(데이터베이스에 관계 없이 상관없이 사용 가능, 전체 스파크 애플리케이션에서 볼수 있으나, 세션이 종료되면 사라짐)</span>
<span class="k">CREATE</span> <span class="k">GLOBAL</span> <span class="k">TEMP</span> <span class="k">VIEW</span> <span class="n">just_usa_global_view_temp</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">dest_country_name</span> <span class="o">=</span> <span class="s1">'United States'</span>

<span class="c1">-- 생성된 뷰를 덮어쓸수 있음</span>
<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TEMP</span> <span class="k">VIEW</span> <span class="n">just_usa_view_temp</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">dest_country_name</span> <span class="o">=</span> <span class="s1">'United States'</span>

</pre></table></code></div></div><ul><li>뷰는 실질적으로 트랜스포메이션이기때문에 쿼리가 실행될 때만 뷰에 정의된 트랜스포메이션이 수행됨.<ul><li>테이블의 데이터를 실제로 조회하는 경우에만 필터를 적용.<li>새로운 DataFrame을 만드는것과 동일</ul></ul><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">val</span> <span class="nv">flights</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"json"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="s">"/data/flight-data/json/2015-summary.json"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">just_usa_df</span> <span class="k">=</span> <span class="nv">flights</span><span class="o">.</span><span class="py">where</span><span class="o">(</span><span class="s">"dest_country_name = 'United States'"</span><span class="o">)</span>
<span class="nv">just_usa_df</span><span class="o">.</span><span class="py">selectExpr</span><span class="o">(</span><span class="s">"*"</span><span class="o">).</span><span class="py">explain</span>
</pre></table></code></div></div><ul><li>내부적으로는 동일한 매커니즘으로 동작하므로 DataFrame이나 SQL 중 편한 방법을 선택해서 사용하면 됨.</ul><p>###10.7.2 뷰 제거하기</p><ul><li>테이블을 제거하는 것과 동일한 방식으로 뷰 제거 가능.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">just_usa_view</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="108-데이터-베이스"><span class="mr-2">10.8 데이터 베이스</span><a href="#108-데이터-베이스" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>데이터베이스는 여러 테이블을 조직화하기 위한 도구이다.<li>스파크에서 실행하는 모든 SQL 명령은 사용중인 데이터베이스 범위 내에서 실행.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1">-- 전체 데이터베이스 목록 조회</span>
<span class="k">SHOW</span> <span class="n">DATABASES</span>
</pre></table></code></div></div><h3 id="1081-데이터베이스-생성하기"><span class="mr-2">10.8.1 데이터베이스 생성하기</span><a href="#1081-데이터베이스-생성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">some_db</span>
</pre></table></code></div></div><h3 id="1082-데이터베이스-설정하기"><span class="mr-2">10.8.2 데이터베이스 설정하기</span><a href="#1082-데이터베이스-설정하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">-- 현재 사용하는 데이터베이스 변경</span>
<span class="n">USE</span> <span class="n">some_db</span>

<span class="c1">--  현재 사용중인 데이터베이스 확인</span>
<span class="k">SELECT</span> <span class="n">current_database</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="1083-데이터베이스-제거하기"><span class="mr-2">10.8.3 데이터베이스 제거하기</span><a href="#1083-데이터베이스-제거하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">some_db</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="109-select-구문"><span class="mr-2">10.9 select 구문</span><a href="#109-select-구문" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>스파크 쿼리는 ANSI SQL 요건을 충족한다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="p">[</span><span class="k">ALL</span><span class="o">|</span><span class="k">DISTINCT</span><span class="p">]</span> <span class="n">named_expression</span><span class="p">[,</span> <span class="n">named_expression</span><span class="p">,</span> <span class="p">...]</span>
    <span class="k">FROM</span> <span class="n">relation</span><span class="p">[,</span> <span class="n">relation</span><span class="p">,</span> <span class="p">...]</span>
    <span class="p">[</span><span class="n">lateral_view</span><span class="p">[,</span> <span class="n">lateral_view</span><span class="p">,</span> <span class="p">...]]</span>
    <span class="p">[</span><span class="k">WHERE</span> <span class="n">boolean_expression</span><span class="p">]</span>
    <span class="p">[</span><span class="n">aggregation</span> <span class="p">[</span><span class="k">HAVING</span> <span class="n">boolean_expression</span><span class="p">]]</span>
    <span class="p">[</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sort_expressions</span><span class="p">]</span>
    <span class="p">[</span><span class="k">CLUSTER</span> <span class="k">BY</span> <span class="n">expressions</span><span class="p">]</span>
    <span class="p">[</span><span class="n">DISTRIBUTE</span> <span class="k">BY</span> <span class="n">expressions</span><span class="p">]</span>
    <span class="p">[</span><span class="n">SORT</span> <span class="k">BY</span> <span class="n">sort_expressions</span><span class="p">]</span>
    <span class="p">[</span><span class="k">WINDOW</span> <span class="n">named_window</span><span class="p">[,</span> <span class="k">WINDOW</span> <span class="n">named_window</span><span class="p">,</span> <span class="p">...]]</span>
    <span class="p">[</span><span class="k">LIMIT</span> <span class="n">num_rows</span><span class="p">]</span>

<span class="n">named_expression</span><span class="p">:</span>
    <span class="p">:</span> <span class="n">expression</span> <span class="p">[</span><span class="k">AS</span> <span class="k">alias</span><span class="p">]</span>

<span class="n">relation</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">join_relation</span>
    <span class="o">|</span> <span class="p">(</span><span class="k">table_name</span><span class="o">|</span><span class="n">query</span><span class="o">|</span><span class="n">relation</span><span class="p">)</span> <span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="p">[</span><span class="k">AS</span> <span class="k">alias</span><span class="p">]</span>
    <span class="p">:</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">expressions</span><span class="p">)[,</span> <span class="p">(</span><span class="n">expressions</span><span class="p">),</span> <span class="p">...]</span>
          <span class="p">[</span><span class="k">AS</span> <span class="p">(</span><span class="k">column_name</span><span class="p">[,</span> <span class="k">column_name</span><span class="p">,</span> <span class="p">...])]</span>

<span class="n">expressions</span><span class="p">:</span>
    <span class="p">:</span> <span class="n">expression</span><span class="p">[,</span> <span class="n">expression</span><span class="p">,</span> <span class="p">...]</span>

<span class="n">sort_expressions</span><span class="p">:</span>
    <span class="p">:</span> <span class="n">expression</span> <span class="p">[</span><span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span><span class="p">][,</span> <span class="n">expression</span> <span class="p">[</span><span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span><span class="p">],</span> <span class="p">...]</span>

</pre></table></code></div></div><h3 id="1091-casewhenthen-구문"><span class="mr-2">10.9.1 case..when..then 구문</span><a href="#1091-casewhenthen-구문" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>SQL 쿼리으 값을 조건에 맞게 변경해야 하는 경우 위 구문을 사용해 조건에 맞는 처리를 할수 있다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">SELECT</span>
  <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">DEST_COUNTRY_NAME</span> <span class="o">=</span> <span class="s1">'UNITED STATES'</span> <span class="k">THEN</span> <span class="mi">1</span>
       <span class="k">WHEN</span> <span class="n">DEST_COUNTRY_NAME</span> <span class="o">=</span> <span class="s1">'Egypt'</span> <span class="k">THEN</span> <span class="mi">0</span>
       <span class="k">ELSE</span> <span class="o">-</span><span class="mi">1</span> <span class="k">END</span>
<span class="k">FROM</span> <span class="n">partitioned_flights</span>
</pre></table></code></div></div><h2 id="1010-고급-주제"><span class="mr-2">10.10 고급 주제</span><a href="#1010-고급-주제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>SQL 구문은 조작, 정의, 제어와 관련된 명령을 정의할 수 있다.</ul><h3 id="10101-복합-데이터-타입"><span class="mr-2">10.10.1 복합 데이터 타입</span><a href="#10101-복합-데이터-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>복합 데이터 타입은 표준 SQL과는 거리가 있는 스파크의 매우 강력한 기능이다.<li>이를 SQL에서 어떻게 적절하게 처리하는지 이해해야 한다.<li>스파크 SQL에는 구조체, 리스트, 맵 3가지 핵심 복합 데이터 타입이 존재함</ul><h4 id="구조체"><span class="mr-2">구조체</span><a href="#구조체" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>구조체는 맵에 더 가까우며 스파크에서 중첩 데이터를 생성하거나 쿼리하는 방법을 제공함.<li>여러 컬럼이나 표현식으로 괄호로 묶기만 하면 된다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">nested_data</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="p">(</span><span class="n">DEST_COUNTRY_NAME</span><span class="p">,</span> <span class="n">ORIGIN_COUNTRY_NAME</span><span class="p">)</span> <span class="k">as</span> <span class="n">country</span><span class="p">,</span> <span class="k">count</span> <span class="k">FROM</span> <span class="n">flights</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">nested_data</span>

<span class="k">SELECT</span> <span class="n">country</span><span class="p">.</span><span class="n">DEST_COUNTRY_NAME</span><span class="p">,</span> <span class="k">count</span> <span class="k">FROM</span> <span class="n">nested_data</span>

<span class="k">SELECT</span> <span class="n">country</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="k">count</span> <span class="k">FROM</span> <span class="n">nested_data</span>
</pre></table></code></div></div><ul><li>구조체의 이름과 모든 하위 컬럼을 지정해 모든 값을 조회할 수 있다.</ul><h4 id="리스트"><span class="mr-2">리스트</span><a href="#리스트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>일반적인 프로그래밍 언어의 리스트와 유사함.<li>값의 배열이나 리스트는 여러가지 방법으로 생성 가능.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">DEST_COUNTRY_NAME</span> <span class="k">as</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">collect_list</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">as</span> <span class="n">flight_counts</span><span class="p">,</span>
  <span class="n">collect_set</span><span class="p">(</span><span class="n">ORIGIN_COUNTRY_NAME</span><span class="p">)</span> <span class="k">as</span> <span class="n">origin_set</span>
<span class="k">FROM</span> <span class="n">flights</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">DEST_COUNTRY_NAME</span>

<span class="k">SELECT</span> <span class="n">DEST_COUNTRY_NAME</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">flights</span>

<span class="k">SELECT</span> <span class="n">DEST_COUNTRY_NAME</span> <span class="k">as</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">collect_list</span><span class="p">(</span><span class="k">count</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">FROM</span> <span class="n">flights</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">DEST_COUNTRY_NAME</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">explode</code> 함수를 사용해 배열을 다시 여러 로우로 변환할 수 있다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TEMP</span> <span class="k">VIEW</span> <span class="n">flights_agg</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="n">DEST_COUNTRY_NAME</span><span class="p">,</span> <span class="n">collect_list</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">as</span> <span class="n">collected_counts</span>
  <span class="k">FROM</span> <span class="n">flights</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">DEST_COUNTRY_NAME</span>


<span class="k">SELECT</span> <span class="n">explode</span><span class="p">(</span><span class="n">collected_counts</span><span class="p">),</span> <span class="n">DEST_COUNTRY_NAME</span> <span class="k">FROM</span> <span class="n">flights_agg</span>
</pre></table></code></div></div><h3 id="10102-함수"><span class="mr-2">10.10.2 함수</span><a href="#10102-함수" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>스파크 SQL은 복합 데이터 타입 외에도 다양한 고급 함수를 제공한다.<li>DataFrame 함수 문서에서 모든 함수를 찾아볼수 있다.<li>SQL로도 제공하는 전체 함수 목록 확인 가능.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">-- 전체</span>
<span class="k">SHOW</span> <span class="n">FUNCTIONS</span>

<span class="c1">-- 내장 시스템 함수</span>
<span class="k">SHOW</span> <span class="k">SYSTEM</span> <span class="n">FUNCTIONS</span>

<span class="c1">-- 누군가가 스파크 환경에 공개한 함수</span>
<span class="k">SHOW</span> <span class="k">USER</span> <span class="n">FUNCTIONS</span>

<span class="c1">-- s로 시작하는 모든 함수</span>
<span class="k">SHOW</span> <span class="n">FUNCTIONS</span> <span class="nv">"s*"</span><span class="p">;</span>

<span class="c1">-- LIKE 키워드를 사용해 함수 검색</span>
<span class="k">SHOW</span> <span class="n">FUNCTIONS</span> <span class="k">LIKE</span> <span class="nv">"collect*"</span><span class="p">;</span>
</pre></table></code></div></div><h4 id="사용자-정의-함수"><span class="mr-2">사용자 정의 함수</span><a href="#사용자-정의-함수" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>스파크는 사용자 정의 함수를 정의하고 분산 환경에서 사용할수 있는 기능을 제공함.<li>특정 언어를 사용해 함수를 개발하고 등록하여 사용할 수 있다.</ul><div class="language-scala highlighter-rouge"><div class="code-header"> <span data-label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">power3</span><span class="o">(</span><span class="n">number</span><span class="k">:</span><span class="kt">Double</span><span class="o">)</span><span class="k">:</span><span class="kt">Double</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span> <span class="o">*</span> <span class="n">number</span>
<span class="nv">spark</span><span class="o">.</span><span class="py">udf</span><span class="o">.</span><span class="py">register</span><span class="o">(</span><span class="s">"power3"</span><span class="o">,</span> <span class="nf">power3</span><span class="o">(</span><span class="k">_:</span><span class="kt">Double</span><span class="o">)</span><span class="k">:</span><span class="kt">Double</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="10103-서브쿼리"><span class="mr-2">10.10.3 서브쿼리</span><a href="#10103-서브쿼리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>서브쿼리르 사용하면 쿼리 안에 쿼리를 지정할 수 있다.<li>SQL에서 정교하 로직을 명시.<li>상호연관 서브쿼리(correlated subquery) : 서브쿼리의 정보를 보완하기 위해 쿼리의 외부 범위에 있는 일부 정보를 사용<li>비상호연관 서브쿼리(uncorrelated subquery) : 외부 범위에 있는 정보를 사용하지 않는 서브쿼리<li>조건절 서브쿼리(predicate subquery) : 값에 따라 필터링할 수 있는 서브 쿼리</ul><h4 id="비상호연관-서브쿼리uncorrelated-subquery"><span class="mr-2">비상호연관 서브쿼리(uncorrelated subquery)</span><a href="#비상호연관-서브쿼리uncorrelated-subquery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://user-images.githubusercontent.com/6982740/210163149-3a285fcd-066f-49c6-a57f-00fa2a9218cc.png" class="popup img-link "><img width="151" alt="스크린샷 2023-01-01 오후 3 53 44" data-src="https://user-images.githubusercontent.com/6982740/210163149-3a285fcd-066f-49c6-a57f-00fa2a9218cc.png" class="lazyload" data-proofer-ignore></a></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">dest_country_name</span> <span class="k">FROM</span> <span class="n">flights</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dest_country_name</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">sum</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">5</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
<span class="k">WHERE</span> <span class="n">origin_country_name</span> <span class="k">IN</span> <span class="p">(</span>
     <span class="k">SELECT</span> <span class="n">dest_country_name</span>
     <span class="k">FROM</span> <span class="n">flights</span>
     <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dest_country_name</span>
     <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">sum</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">DESC</span>
     <span class="k">LIMIT</span> <span class="mi">5</span>
<span class="p">)</span>
</pre></table></code></div></div><h4 id="상호연관-서브쿼리correlated-subquery"><span class="mr-2">상호연관 서브쿼리(correlated subquery)</span><a href="#상호연관-서브쿼리correlated-subquery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="n">f1</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span>
     <span class="k">SELECT</span> <span class="mi">1</span>
     <span class="k">FROM</span> <span class="n">flights</span> <span class="n">f2</span>
     <span class="k">WHERE</span> <span class="n">f1</span><span class="p">.</span><span class="n">dest_country_name</span> <span class="o">=</span> <span class="n">f2</span><span class="p">.</span><span class="n">origin_country_name</span>
<span class="p">)</span>
<span class="k">AND</span> <span class="k">EXISTS</span> <span class="p">(</span>
     <span class="k">SELECT</span> <span class="mi">1</span>
     <span class="k">FROM</span> <span class="n">flights</span> <span class="n">f2</span>
     <span class="k">WHERE</span> <span class="n">f2</span><span class="p">.</span><span class="n">dest_country_name</span> <span class="o">=</span> <span class="n">f1</span><span class="p">.</span><span class="n">origin_country_name</span>
<span class="p">)</span>
</pre></table></code></div></div><h4 id="비상호연관-스칼라-쿼리"><span class="mr-2">비상호연관 스칼라 쿼리</span><a href="#비상호연관-스칼라-쿼리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>기존에 없던 일부 부가 정보를 가져올 수 있다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">flights</span><span class="p">)</span> <span class="k">AS</span> <span class="n">maximum</span>
<span class="k">FROM</span> <span class="n">flights</span>
</pre></table></code></div></div><h2 id="1011-다양한-기능"><span class="mr-2">10.11 다양한 기능</span><a href="#1011-다양한-기능" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>SQL 코드의 성능 최적화나 디버깅이 필요한 경우 관련될 수 있는 부분들</ul><h3 id="10111-설정"><span class="mr-2">10.11.1 설정</span><a href="#10111-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>애플리케이션과 관련된 몇가지 환경 설정값들이 있다.<li>셔플 파티션 수를 조정하는 것처럼 애플리케이션 초기화 시점 혹은 애플리케이션 실행 시점에 설정 가능.</ul><p><a href="https://user-images.githubusercontent.com/6982740/210163238-3a9002b4-2e9b-44dc-adb7-43812c0e42b7.png" class="popup img-link "><img width="650" alt="스크린샷 2023-01-01 오후 3 57 02" data-src="https://user-images.githubusercontent.com/6982740/210163238-3a9002b4-2e9b-44dc-adb7-43812c0e42b7.png" class="lazyload" data-proofer-ignore></a></p><p><a href="https://user-images.githubusercontent.com/6982740/210163241-7062748c-cb89-445e-8da5-d3e2eefd7c6e.png" class="popup img-link "><img width="650" alt="스크린샷 2023-01-01 오후 3 57 14" data-src="https://user-images.githubusercontent.com/6982740/210163241-7062748c-cb89-445e-8da5-d3e2eefd7c6e.png" class="lazyload" data-proofer-ignore></a></p><h3 id="10112-sql에-설정값-지정하기"><span class="mr-2">10.11.2 SQL에 설정값 지정하기</span><a href="#10112-sql에-설정값-지정하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>SQL을 사용해 환경을 설정하는 경우 스파크 SQL과 관련된 설정만 가능하다는 것을 참고해야 한다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1">-- 셔플 파티션 수를 지정하는 방법</span>
<span class="k">SET</span> <span class="n">spark</span><span class="p">.</span><span class="k">sql</span><span class="p">.</span><span class="n">shuffle</span><span class="p">.</span><span class="n">partitions</span><span class="o">=</span><span class="mi">20</span>
</pre></table></code></div></div><h2 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://www.coupang.com/vp/products/164359777?itemId=471497435&amp;vendorItemId=4215695264&amp;src=1042503&amp;spec=10304982&amp;addtag=400&amp;ctag=164359777&amp;lptag=10304982I471497435&amp;itime=20221030164504&amp;pageType=PRODUCT&amp;pageValue=164359777&amp;wPcid=16589055075836517214634&amp;wRef=&amp;wTime=20221030164504&amp;redirect=landing&amp;gclid=Cj0KCQjwwfiaBhC7ARIsAGvcPe7kxytxjJU9Ylxpe5l8Jk9zhXhknDFceRzD80Zn6IzxUaF-RPn5OKAaAnGxEALw_wcB&amp;campaignid=18626086777&amp;adgroupid=">Spark 완벽 가이드</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devlog/'>DevLog</a>, <a href='/categories/spark/'>Spark</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spark/" class="post-tag no-text-decoration" >Spark</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[%EC%8A%A4%ED%8C%8C%ED%81%AC%20%EC%99%84%EB%B2%BD%20%EA%B0%80%EC%9D%B4%EB%93%9C]%2010.%20%EC%8A%A4%ED%8C%8C%ED%81%AC%20SQL%20-%20Sungsu's%20Tech%20Blog&url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fspark-guide-10%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[%EC%8A%A4%ED%8C%8C%ED%81%AC%20%EC%99%84%EB%B2%BD%20%EA%B0%80%EC%9D%B4%EB%93%9C]%2010.%20%EC%8A%A4%ED%8C%8C%ED%81%AC%20SQL%20-%20Sungsu's%20Tech%20Blog&u=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fspark-guide-10%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fspark-guide-10%2F&text=[%EC%8A%A4%ED%8C%8C%ED%81%AC%20%EC%99%84%EB%B2%BD%20%EA%B0%80%EC%9D%B4%EB%93%9C]%2010.%20%EC%8A%A4%ED%8C%8C%ED%81%AC%20SQL%20-%20Sungsu's%20Tech%20Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/es-bible-4-3/">[엘라스틱서치 바이블] 4. 데이터 다루기 -3(ES Client 라이브러리)</a><li><a href="/posts/es-bible-4-2/">[엘라스틱서치 바이블] 4. 데이터 다루기 -2(집계)</a><li><a href="/posts/es-bible-2/">[엘라스틱서치 바이블] 2. 엘라스틱 서치 기본 동작과 구조</a><li><a href="/posts/es-bible-3-1/">[엘라스틱서치 바이블] 3. 인덱스 설계 - 1</a><li><a href="/posts/spark-guide-6/">[스파크 완벽 가이드] 6. 다양한 데이터 타입 다루기</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spark-guide/"><div class="card-body"> <em class="small" data-ts="1666338360" data-df="ll" > Oct 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[스파크 완벽 가이드] 0. 스파크 시작하기</h3><div class="text-muted small"><p> 스파크 시작하기 곧 업무에서 스파크를 사용해야 해서 스파크를 재대로 공부해봐야겠다고 생각했다. 그래서 일단 local 환경에서 spark를 설치하고, 간단한 작업들을 해보려고 한다. 1. 스파크 설치 2020 m1 osx 를 기준으로 작성되었음을 알려드립니다. # java 설치 arch -arm64 brew install ope...</p></div></div></a></div><div class="card"> <a href="/posts/spark-guide-2/"><div class="card-body"> <em class="small" data-ts="1667029560" data-df="ll" > Oct 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[스파크 완벽 가이드] 2. 스파크 간단히 살펴보기</h3><div class="text-muted small"><p> [스파크 완벽 가이드] 2. 스파크 간단히 살펴보기 2.1 스파크의 기본 아키텍쳐 2.1.1 스파크 애플리케이션 driver 프로세스와 executor 프로세스로 구성됨. driver 프로세스는 zeppelin 같은 BI 툴이 될수도 있고, spring application같은것이 될수도 있음. 로컬 모드 위 그림과 같이 클러스터...</p></div></div></a></div><div class="card"> <a href="/posts/spark-guide-3/"><div class="card-body"> <em class="small" data-ts="1667037120" data-df="ll" > Oct 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[스파크 완벽 가이드] 3. 스파크 기능 둘러보기</h3><div class="text-muted small"><p> [스파크 완벽 가이드] 3. 스파크 기능 둘러보기 3.1 스파크의 기능 3.2 Dataset : 타입 안정성을 제공하는 구조적 API 자바와 스칼라의 정적 데이터 타입 코드를 지원하기 위해 고안된 구조적 API 이는 타입 안정성을 지원하고, 동적 타입 언어인 파이썬과 R에서는 사용할수 없음. case class Flight(DEST_...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spark-guide-9/" class="btn btn-outline-primary" prompt="Older"><p>[스파크 완벽 가이드] 9. 데이터소스</p></a> <a href="/posts/spark-guide-11/" class="btn btn-outline-primary" prompt="Newer"><p>[스파크 완벽 가이드] 11. Dataset</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://sungsu9022.github.io/posts/spark-guide-10/'; this.page.identifier = '/posts/spark-guide-10/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://sungsu-parks-tech-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/sungsu9022dev">sungsu9022</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-145894105-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-145894105-1'); }); </script>
