<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="[엘라스틱서치 바이블] 3. 인덱스 설계 - 1" /><meta name="author" content="sungsu park" /><meta property="og:locale" content="en" /><meta name="description" content="3. 인덱스 설계 - 1 ES의 인덱스는 아주 세부적인 부분까지 설정으로 제어할 수 있다. 이 설정에 따라 동작과 특성이 매우 달라지므로 인덱스 설계에 신경써야 한다. 맵핑, 필드 타입, 애널라이저 등 핵심적인 설정을 학습해 ES 인덱스에 대한 이해도를 높여보자." /><meta property="og:description" content="3. 인덱스 설계 - 1 ES의 인덱스는 아주 세부적인 부분까지 설정으로 제어할 수 있다. 이 설정에 따라 동작과 특성이 매우 달라지므로 인덱스 설계에 신경써야 한다. 맵핑, 필드 타입, 애널라이저 등 핵심적인 설정을 학습해 ES 인덱스에 대한 이해도를 높여보자." /><link rel="canonical" href="https://sungsu9022.github.io/posts/es-bible-3-1/" /><meta property="og:url" content="https://sungsu9022.github.io/posts/es-bible-3-1/" /><meta property="og:site_name" content="Sungsu’s Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-11-18T18:50:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[엘라스틱서치 바이블] 3. 인덱스 설계 - 1" /><meta name="twitter:site" content="@sungsu9022dev" /><meta name="twitter:creator" content="@sungsu park" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"sungsu park"},"dateModified":"2023-12-09T19:19:15+09:00","datePublished":"2023-11-18T18:50:00+09:00","description":"3. 인덱스 설계 - 1 ES의 인덱스는 아주 세부적인 부분까지 설정으로 제어할 수 있다. 이 설정에 따라 동작과 특성이 매우 달라지므로 인덱스 설계에 신경써야 한다. 맵핑, 필드 타입, 애널라이저 등 핵심적인 설정을 학습해 ES 인덱스에 대한 이해도를 높여보자.","headline":"[엘라스틱서치 바이블] 3. 인덱스 설계 - 1","mainEntityOfPage":{"@type":"WebPage","@id":"https://sungsu9022.github.io/posts/es-bible-3-1/"},"url":"https://sungsu9022.github.io/posts/es-bible-3-1/"}</script><title>[엘라스틱서치 바이블] 3. 인덱스 설계 - 1 | Sungsu's Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sungsu's Tech Blog"><meta name="application-name" content="Sungsu's Tech Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/personal/sunny.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Sungsu's Tech Blog</a></div><div class="site-subtitle font-italic">Java/Kotlin Spring, Back-end</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/sungsu9022" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/sungsu9022dev" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['sungsu9022','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[엘라스틱서치 바이블] 3. 인덱스 설계 - 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[엘라스틱서치 바이블] 3. 인덱스 설계 - 1</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1700301000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 18, 2023 </em> </span> <span> Updated <em class="" data-ts="1702117155" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 9, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8384 words"> <em>46 min</em> read</span></div></div></div><div class="post-content"><h1 id="3-인덱스-설계---1">3. 인덱스 설계 - 1</h1><ul><li>ES의 인덱스는 아주 세부적인 부분까지 설정으로 제어할 수 있다.<li>이 설정에 따라 동작과 특성이 매우 달라지므로 인덱스 설계에 신경써야 한다.<li>맵핑, 필드 타입, 애널라이저 등 핵심적인 설정을 학습해 ES 인덱스에 대한 이해도를 높여보자.</ul><h2 id="31-인덱스-설정"><span class="mr-2">3.1 인덱스 설정</span><a href="#31-인덱스-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>인덱스 생성시 동작에 관한 설정을 지정할 수 있다.</ul><h3 id="인덱스-설정-조회"><span class="mr-2">인덱스 설정 조회</span><a href="#인덱스-설정-조회" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>[GET] [인덱스 이름]/_settings
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>GET /my_index/_settings
Host: localhost:9200
Content-Type: application/json
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"my_index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"routing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"allocation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			  </span><span class="nl">"_tier_preference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data_content"</span><span class="w">
			</span><span class="p">}</span><span class="w">
		  </span><span class="p">}</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"number_of_shards"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"provided_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_index"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"creation_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1700298266901"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"number_of_replicas"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"O1_nsfp1Rc-f8RPSSUiWUg"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8050299"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="인덱스-설정-변경"><span class="mr-2">인덱스 설정 변경</span><a href="#인덱스-설정-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>[PUT] [인덱스 이름]/_settings

{
    [변경할 내용]
}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>PUT /my_index/_settings
Host: localhost:9200
Content-Type: application/json

{
  "index.number_of_replicas": 0
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="311-number_of_shards"><span class="mr-2">3.1.1 number_of_shards</span><a href="#311-number_of_shards" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>number_of_shards는 이 인덱스가 데이터를 몇 개의 샤드로 쪼갤 것인지를 지정하는 값이다.<li>이 값은 매우 신중하게 설계해야 한다.<li>한번 지정하면 reindex 같은 동작을 통해 인덱스를 통째로 재색인하는 등 특별한 작업을 수행하지 않는 한 바꿀수 없기 떄문이다.<li>샤드 개수를 어떻게 지정하느냐는 ES 클러스터 전체의 성능에도 큰 영향을 미친다.<li>ES7부터 기본값은 1(이전에는 5였음)</ul><h4 id="주의-사항"><span class="mr-2">주의 사항</span><a href="#주의-사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>샤드 하나마다 루씬 인덱스가 하나씩 더 생성된다는 사실과 주 샤드 하나당 복제본 샤드도 늘어난다는 사실을 염두에 둬야 한다.<li>샤드 숫자가 너무 많아지면 클러스터 성능이 떨어지고, 색인 성능이 감소한다.<li>인덱스당 샤드 숫자를 작게 지정하면 샤드 하나의 크기가 커진다. 샤드의 크기가 지나치게 커지면 장애 상황 등에서 샤드 복구에 너무 많은 시간이 소요되고, 클러스터 안정성이 떨어진다.<li>실제 운영을 하게 된다면 대량 데이터를 담기 위해 이 값을 적절한 값으로 꼭 조정해줘야 한다.</ul><h3 id="312-number_of_replicas"><span class="mr-2">3.1.2 number_of_replicas</span><a href="#312-number_of_replicas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>주 샤드 하나당 복제본 샤드를 몇개 둘 것인지를 지정하는 설정<li>ES 클러스터에 몇 개의 노드를 붙일 것이며, 어느 정도 고가용성을 제공할 것인지 등을 고려해서 지정하면 된다.<li>0으로 설정할 경우 복제본 샤드를 생성하지 않고 주 샤드만 두는 설정이다.<li>복제본 샤드를 생성하지 않는 설정은 주로 대용량 초기 데이터를 마이그레이션 하는 등의 시나리오에서 쓰기 성능을 일시적으로 끌어올리기 위해 사용한다.</ul><h3 id="313-refresh_interval"><span class="mr-2">3.1.3 refresh_interval</span><a href="#313-refresh_interval" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>ES가 해당 인덱스를 대상으로 refresh를 얼마나 자주 수행할 것인지를 지정한다.<li>색인된 문서는 refresh되어야 하는 검색 대상이 되기 때문에 중요한 설정이다.<li><code class="language-plaintext highlighter-rouge">-1</code>로 값을 지정하면 주기적 refresh를 수행하지 않는다.<li>설정 조회시 명시적으로 설정돼 있지 않은 경우 1초 defaut로 수행한다.(기본값 설정으로 되돌린다면 null로 업데이트하면된다)</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>PUT /my_index/_settings
Host: localhost:9200
Content-Type: application/json

{
  "index.refresh_interval": "1s"
}
</pre></table></code></div></div><h3 id="314-인덱스-설정을-지정하여-인덱스-생성"><span class="mr-2">3.1.4 인덱스 설정을 지정하여 인덱스 생성</span><a href="#314-인덱스-설정을-지정하여-인덱스-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>별도의 설정 없이 인덱스를 생성하는 경우 기본 설정으로 생성되는데, 설정을 포함하여 인덱스를 생성할 수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>PUT [인덱스 이름]
{
     "settings": {
        [인덱스 설정]
    }
  }
}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>PUT /my_index2
Host: localhost:9200
Content-Type: application/json

{
  "settings": {
    "index.number_of_shards": 2,
    "index.number_of_replicas": 2
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"shards_acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_index2"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">acknowledged</code> 는 해당 인덱스가 클러스터에 제대로 생성되었는지 여부를 나타낸다.<li><code class="language-plaintext highlighter-rouge">shards_acknowledged</code> 값은 타임아웃이 떨어지기 전에 지정한 개수만큼 샤드가 활성화되었는지를 나타낸다.<li><code class="language-plaintext highlighter-rouge">wait_for_active_shareds</code> 인자로 해당 개수를 지정할 수 있다.<ul><li>기본적으로는 1개의 샤드, 즉 주샤드가 시간 안에 활용화되면 true를 반환한다.</ul></ul><h3 id="315-인덱스-삭제"><span class="mr-2">3.1.5 인덱스 삭제</span><a href="#315-인덱스-삭제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>DELETE [인덱스 이름]
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>DELETE /my_index2
Host: localhost:9200
</pre></table></code></div></div><h3 id="316-인덱스-설정-재대로-적용되었는지-조회"><span class="mr-2">3.1.6 인덱스 설정 재대로 적용되었는지 조회</span><a href="#316-인덱스-설정-재대로-적용되었는지-조회" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>GET /my_index2
Host: localhost:9200
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"my_index2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"aliases"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
	</span><span class="nl">"mappings"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
	</span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"routing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"allocation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			  </span><span class="nl">"_tier_preference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data_content"</span><span class="w">
			</span><span class="p">}</span><span class="w">
		  </span><span class="p">}</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"number_of_shards"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"provided_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_index2"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"creation_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1700304795832"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"number_of_replicas"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"l2KPoucXQbOwxk1W0oto4A"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8050299"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="32-매핑과-필드-타입"><span class="mr-2">3.2 매핑과 필드 타입</span><a href="#32-매핑과-필드-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>매핑은 문서가 인덱스에 어떻게 색인되고 저장되는지 정의하는 부분이다.<li>JSON 문서의 각 필드를 어떤방식으로 분석하고 색인할지, 어떤 타입으로 저장할지 등을 세부적으로 지정할 수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>### 데이터 생성
PUT /my_index2/_doc/1
Host: localhost:9200
Content-Type: application/json

{
  "title": "Hello world",
  "views": 1234,
  "public": true,
  "point": 4.5,
  "created" : "2023-11-18T20:00:00.000Z"
}

### 인덱스 조회
GET /my_index2
Host: localhost:9200
Content-Type: application/json
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"my_index2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"aliases"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
	</span><span class="nl">"mappings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"point"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"float"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"public"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
		  </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"keyword"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keyword"</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"ignore_above"</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="w">
			</span><span class="p">}</span><span class="w">
		  </span><span class="p">}</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>이전에 없던 mappings 항목 밑에 각 필드의 타입과 관련된 정보가 새로 생긴 것을 확인할 수 있다.</ul><h3 id="321-동적-매핑-vs-명시적-매핑"><span class="mr-2">3.2.1 동적 매핑 vs. 명시적 매핑</span><a href="#321-동적-매핑-vs-명시적-매핑" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>ES가 자동으로 생성하는 매핑을 동적 매핑(Dynamic Mapping)이라고 부른다.<li>반대로 사용자가 직접 맵핑을 지정해주는 방법을 명시적 맵핑(Explicit Mapping)이라고 부른다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>PUT /mapping_test
Host: localhost:9200
Content-Type: application/json

{
  "mappings": {
    "properties": {
      "createdDate":{
        "type": "date",
        "format": "strict_date_time || epoch_millis"
      },
      "keywordString": {
        "type": "keyword"
      },
      "textString": {
        "type": "text"
      }
    }
  },
  "settings": {
    "index.number_of_shards": 1,
    "index.number_of_replicas": 1
  }
}
</pre></table></code></div></div><ul><li>각 필드에 데이터를 어떠한 형태로 저장할 것인지 타입이라는 설정으로 지정했다.<li>중요한 것은 필드 타입을 포함한 매핑 설정 내 대부분의 내용은 한 번 지정되면 사실상 변경이 불가능하므로 서비스 설계와 데이터 설계를 할때는 매우 신중하게 해야 한다.<li>위와 같은 이유로 서비스 운영 환경에서 대용량의 데이터를 처리해야 할 때는 기본적으로 명시된 매핑을 지정해서 인덱스를 운영해야 한다.<ul><li>이 매핑을 어떻게 하느냐에 따라 서비스 운영 양상이 많이 달라지고, 성능의 차이도 크다.</ul></ul><h4 id="맵핑-신규-필드-추가"><span class="mr-2">맵핑 신규 필드 추가</span><a href="#맵핑-신규-필드-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>신규 필드 추가가 예정돼 있다면 동적 매핑에 기대지 말고 명시적으로 매핑을 지정하는것이 좋다.<li>다음과 같이 신규 필드 매핑 정보를 추가할 수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### 3.2.1 맵핑 신규 필드 추가
PUT /mapping_test/_mapping
Host: localhost:9200
Content-Type: application/json

{
  "properties": {
    "longValue": {
      "type": "long"
      }
    }
}
</pre></table></code></div></div><h4 id="맵핑-조회"><span class="mr-2">맵핑 조회</span><a href="#맵핑-조회" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>### 3.2.1 맵핑 조회
GET /mapping_test/_mapping
Host: localhost:9200
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"mapping_test"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"mappings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"createdDate"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w">
		  </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"strict_date_time || epoch_millis"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"keywordString"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keyword"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"longValue"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"textString"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="322-필드-타입"><span class="mr-2">3.2.2 필드 타입</span><a href="#322-필드-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>매핑의 기본은 필드 타입이다.<li>매핑의 필드 타입은 한번 지정되면 변경이 불가능하므로 매우 신중하게 지정해야 한다.</ul><h4 id="심플-타입"><span class="mr-2">심플 타입</span><a href="#심플-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">keyword</code>, <code class="language-plaintext highlighter-rouge">date</code>, <code class="language-plaintext highlighter-rouge">long</code>, <code class="language-plaintext highlighter-rouge">double</code>, <code class="language-plaintext highlighter-rouge">boolean</code>, <code class="language-plaintext highlighter-rouge">ip</code> 등<li>주로 직관적으로 알기 쉬운 간단한 자료형이다.</ul><h5 id="숫자-타입"><span class="mr-2">숫자 타입</span><a href="#숫자-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>ES에서 지원하는 숫자 타입은 다음과 같다.<ul><li>long, integer, short, byte, double, float, half_float, scaled_float</ul><li>작은 비트를 사용하는 자료형을 고르면 색인과 검색시 이득이 있다. 다만 저장할 때는 실제 값에 맞춰 최적화되기 때문에 디스크 사용량에는 이득이 없다.<li>부동소수점 수를 담는 필드라면 일반적으로 scaled_float 타입을 고려할 수 있다.<ul><li>고정 환산 계수로 스케일링하고, long으로 저장되는데, 이를 사용하는 경우 정확도에서 손해를 보는 만큼 디스크를 절약할수 있다.</ul></ul><h4 id="date-타입"><span class="mr-2">date 타입</span><a href="#date-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nl">"createdDate"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"strict_date_time || epoch_millis"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>필드 맵핑에 정의한 내용을 다시 살펴보면 2가지 format을 지원하므로 2가지를 모두 저장할 수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>### 3.2.2 dateType
PUT /mapping_test/_doc/1
Host: localhost:9200
Content-Type: application/json

{
  "createdDate": "2020-09-03T02:41:32.001Z"
}

### 3.2.2 dateType2
PUT /mapping_test/_doc/2
Host: localhost:9200
Content-Type: application/json

{
  "createdDate": 1599068514123
}
</pre></table></code></div></div><ul><li>위처럼 2개의 문서를 모두 추가 가능하다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>GET /mapping_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "range": {
      "createdDate": {
        "gte": "2020-09-02T17:00:00.000Z",
        "lte": "2020-09-03T03:00:00.000Z"
      }
    }
  }
}
</pre></table></code></div></div><ul><li>range을 이용해서 조회하면 다음과 같은 결과를 얻을 수 있다.</ul><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">354</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mapping_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"createdDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-03T02:41:32.001Z"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">},</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mapping_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"createdDate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1599068514123</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>같은 필드에 문자열의 형식으로 문서를 색인 요청하든지 epoch milliseconds 형식으로 요청하든지 상관없이 모두 성공적으로 ES에 색인되는것을 확인할 수 있다.<li>format은 여러 형식으로 지정할 수 있으며, 문서가 어떤 형식으로 들어오더라도 ES 내부적으로는 UTC 시간대로 변환하는 과정을 거쳐 epoch millisec 형식의 long 숫자로 색인된다.<li>위 예제에 정의된 2가지 타입 외에 epoch_second, date_time, date_optional_time, strict_date_optional_time 등이 더 있다.</ul><h4 id="배열"><span class="mr-2">배열</span><a href="#배열" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>long 타입 필드에는 309라는 단일 숫자 데이터를 넣을수도 있고, [221, 309, 1599208568] 과 같은 배열 데이터도 넣을수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>### 인덱스 생성
PUT /array_test
Host: localhost:9200
Content-Type: application/json

{
  "mappings": {
    "properties": {
      "longField": {
        "type": "long"
      },
      "keywordField": {
        "type": "keyword"
      }
    }
  }
}

### 배열 인덱스 doc 추가
PUT /array_test/_doc/1
Host: localhost:9200
Content-Type: application/json

{
  "longField": 309,
  "keywordField": ["hello", "world"]
}

### 배열 인덱스 doc 추가2
PUT /array_test/_doc/2
Host: localhost:9200
Content-Type: application/json

{
  "longField": [221, 309, 1599208568],
  "keywordField": "hello"
}
</pre></table></code></div></div><ul><li>문서들을 색인해보면 모두 성공적으로 색인이 되는것을 알수 있다.</ul><h5 id="실패하는-케이스-타입을-다르게-하는-경우"><span class="mr-2">실패하는 케이스( 타입을 다르게 하는 경우)</span><a href="#실패하는-케이스-타입을-다르게-하는-경우" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>### 3.2.2 배열 인덱스 doc 추가 실패
PUT /array_test/_doc/2
Host: localhost:9200
Content-Type: application/json

{
  "longField": [221, "hello"]
}
</pre></table></code></div></div><h5 id="term-을-통해-문서-내-지정한-필드의-값-질의"><span class="mr-2"><code class="language-plaintext highlighter-rouge">term</code> 을 통해 문서 내 지정한 필드의 값 질의</span><a href="#term-을-통해-문서-내-지정한-필드의-값-질의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### 3.2.2 배열 인덱스 조회
GET /array_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "term": {
      "longField": 309
    }
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"longField"</span><span class="p">:</span><span class="w"> </span><span class="mi">309</span><span class="p">,</span><span class="w">
		  </span><span class="nl">"keywordField"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
			</span><span class="s2">"hello"</span><span class="p">,</span><span class="w">
			</span><span class="s2">"world"</span><span class="w">
		  </span><span class="p">]</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">},</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"longField"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
			</span><span class="mi">221</span><span class="p">,</span><span class="w">
			</span><span class="mi">309</span><span class="p">,</span><span class="w">
			</span><span class="mi">1599208568</span><span class="w">
		  </span><span class="p">],</span><span class="w">
		  </span><span class="nl">"keywordField"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hello"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>조회 결과를 보면 단일데이터, 배열데이터에 관계 없이 모두 검색 결과에 포함된것을 알수 있는데, 이는 ES 색인 과정에서 데이터가 각 값마다 하나의 독립적인 역색인을 구성하기 떄문이다.</ul><h4 id="계층-구조를-지원하는-타입"><span class="mr-2">계층 구조를 지원하는 타입</span><a href="#계층-구조를-지원하는-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>필드 하위에 다른 필드가 들어가는 계층 구조의 데이터를 담는 타입으로 ojbect와 nested가 있다.<li>위 2가지가 유사하지만, 배열을 처리할 때는 동작이 다르다.</ul><h5 id="object-타입"><span class="mr-2">object 타입</span><a href="#object-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>JSON 문서는 필드의 하위에 다른 필드를 여럿 포함하는 객체 데이터를 담을수 있다.<li>object 타입은 이러한 형태의 데이터를 담는 필드 타입이다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>### object 타입 인덱스 doc 추가
PUT /object_test/_doc/1
Host: localhost:9200
Content-Type: application/json

{
  "price": 27770.75,
  "spec": {
    "cores":12,
    "memory": 128,
    "storage": 8000
  }
}


### object 타입 인덱스 mapping 조회
GET /object_test/_mappings
Host: localhost:9200
Content-Type: application/json
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"object_test"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"mappings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"float"</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="nl">"spec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
			</span><span class="p">}</span><span class="w">
		  </span><span class="p">}</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>응답을 살펴보면 spec 필드의 타입을 명시적으로 ojbejct라고 표현하지는 않았는데, 이는 기본값이 object 타입이기 떄문이다.</ul><h5 id="object와-nested-타입의-배열-처리시-다른-동작-확인"><span class="mr-2">object와 nested 타입의 배열 처리시 다른 동작 확인</span><a href="#object와-nested-타입의-배열-처리시-다른-동작-확인" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>###  object 타입 배열로 색인
PUT /object_test/_doc/2
Host: localhost:9200
Content-Type: application/json

{
  "spec": [
    {
      "cores":12,
      "memory": 128,
      "storage": 8000
    },
    {
      "cores":6,
      "memory": 64,
      "storage": 8000
    },
    {
      "cores":6,
      "memory": 32,
      "storage": 4000
    }
  ]
}

### object 타입 배열에 대한 색인 확인
GET /object_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "spec.cores": "6"
          }
        },
        {
          "term": {
            "spec.memory": "128"
          }
        }
      ]
    }
  }
}
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">bool</code> 쿼리의 <code class="language-plaintext highlighter-rouge">must</code> 절에 쿼리를 여러 개 넣을 경우 각 쿼리가 AND조건으로 연결된다.<ul><li>위 조건대로라면 이 두 조건을 동시에 만족하는 객체는 존재하지 않으므로 예상대로라면 검색 결과는 비어야 한다. 하지만, 결과는 다르다.</ul></ul><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">970</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"spec"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
			</span><span class="p">{</span><span class="w">
			  </span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">8000</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="p">{</span><span class="w">
			  </span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">8000</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="p">{</span><span class="w">
			  </span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="w">
			</span><span class="p">}</span><span class="w">
		  </span><span class="p">]</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>위 검색 결과는 object 타입의 데이터가 어떻게 평탄화되는지를 상기해보면 이해할 수 있다.<li>위 문서는 내부적으로 다음과 같은 형태로 데이터 평탄화가 된다.</ul><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"spec.cores"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">],</span><span class="w">
    </span><span class="nl">"spec.memory"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">],</span><span class="w">
    </span><span class="nl">"spec.cores"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>object 타입의 배열은 배열을 구성하는 객체 데이터를 서로 독립적인 데이터로 취급하지 않는다.<li>만약 이들을 독립적인 데이터로 취급하기를 원한다면 <code class="language-plaintext highlighter-rouge">nested</code> 타입을 사용해야 한다.</ul><h4 id="nested-타입"><span class="mr-2">nested 타입</span><a href="#nested-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>nested 타입은 ojbect 타입과느 ㄴ다르게 배열 내 각 객체를 독립적으로 취급한다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre><td class="rouge-code"><pre>### nested type index 추가
PUT /nested_test
Host: localhost:9200
Content-Type: application/json

{
  "mappings": {
    "properties": {
      "spec":{
        "type": "nested",
        "properties": {
          "cores": {
            "type": "long"
          },
          "memory": {
            "type": "long"
          },
          "storage": {
            "type": "long"
          }
        }
      }
    }
  }
}

### nested type doc 추가
PUT /nested_test/_doc/1
Host: localhost:9200
Content-Type: application/json

{
  "spec": [
    {
      "cores":12,
      "memory": 128,
      "storage": 8000
    },
    {
      "cores":6,
      "memory": 64,
      "storage": 8000
    },
    {
      "cores":6,
      "memory": 32,
      "storage": 4000
    }
  ]
}

### nested 타입 search
GET /nested_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "spec.cores": "6"
          }
        },
        {
          "term": {
            "spec.memory": "128"
          }
        }
      ]
    }
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">352</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>object 타입과 동일한 검색쿼리로 조회했지만 결과는 나오지 않는다.<li>nested 타입은 객체 배열의 각 객체를 내부적으로 별도의 루씬 문서로 분리해 저장한다.<ul><li>만약 배열의 원소가 100개라면 부모 문서까지 해서 101개의 문서가 내부적으로 생성된다.<li>이런 nested의 동작은 ES 내에서 굉장히 특수하기 때문에 nested 쿼리라는 전용 쿼리를 이용해 검색해야 한다.</ul></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>### nested 전용 쿼리 search
GET /nested_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "nested": {
      "path": "spec",
      "query": {
        "bool": {
          "must": [
            {
              "term": {
                "spec.cores": "6"
              }
            },
            {
              "term": {
                "spec.memory": "64"
              }
            }
          ]
        }
      }
    }
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nested_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"spec"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
			</span><span class="p">{</span><span class="w">
			  </span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">8000</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="p">{</span><span class="w">
			  </span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">8000</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="p">{</span><span class="w">
			  </span><span class="nl">"cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
			  </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="w">
			</span><span class="p">}</span><span class="w">
		  </span><span class="p">]</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">spec.memory</code> 값을 64로 지정하면 검색에 걸리지만, 128로 지정하면 걸리지 않는다.</ul><h5 id="nested-타입의-성능-문제"><span class="mr-2">nested 타입의 성능 문제</span><a href="#nested-타입의-성능-문제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>nested 타입은 내부적으로 각 객체를 별도의 문서로 분리해서 저장하기 때문에 성능 문제가 있을수 있다.<li>ES에서는 무분별한 nested 타입의 사용을 막기 위해 인덱스 설정으로 2가지 제한을 걸어 놓았다.<ul><li><code class="language-plaintext highlighter-rouge">index.mapping.netsed_fields.limit</code> : nested 타입을 몇개까지 지어할수 있는지 제한(default 50)<li><code class="language-plaintext highlighter-rouge">index.mapping._nested_objects.limit</code> : 한 문서가 nested 객체를 몇 개 까지 가질수 있는지 제한(default 10,000)<li>위 값들을 무리하게 높이면 OOM의 위험이 있음.</ul></ul><h5 id="object-vs-nested-간단-비교"><span class="mr-2">object vs nested 간단 비교</span><a href="#object-vs-nested-간단-비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="table-wrapper"><table><thead><tr><th>타입<th>object<th>nested<tbody><tr><td>용도<td>일반적인 계층 구조에 사용<td>배열 내 각 객체를 독립적으로 취급해야 하는 특수한 상황에서 사용<tr><td>성능<td>상대적으로 가벼움.<td>상대적으로 무겁다. 내부적으로 숨겨진 문서가 생성됨<tr><td>검색<td>일반적인 쿼리를 사용<td>전용 nested 쿼리로 감싸서 사용해야 한다.</table></div><h4 id="그-외-타입"><span class="mr-2">그 외 타입</span><a href="#그-외-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>ES 인덱스의 필드 탕비에는 이 외에도 다양한 비즈니스 요구사항을 위한 타입들이 있다.<li>그 중에 몇가지만 소개하자면 다음과 같다.</ul><div class="table-wrapper"><table><thead><tr><th>종류<th>설명<tbody><tr><td>geo_point<td>위도와 경도를 저장<tr><td>geo_shape<td>지도상에 특정 지점이나 선, 도형 등을 표현하는 타입<tr><td>binary<td>base64로 인코딩된 문자열을 저장하는 타입<tr><td>long_rage, date_range, ip_range 등<td>경곗값을 지정하는 방법 등을 통해 수, 날짜, IP 등의 범위를 저장<tr><td>completion<td>자동완성 검색을 위한 특수한 타입</table></div><h4 id="text-타입과-keyword-타입"><span class="mr-2">text 타입과 keyword 타입</span><a href="#text-타입과-keyword-타입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>문자열 자료형을 담는 필드는 text와 keyword 타입 중 하나를 선택해 적용할 수 있다.</ul><h5 id="text"><span class="mr-2">text</span><a href="#text" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>text로 지정된 필드 값은 애널라이저가 적용된 후 색인된다. 이는 문자열 값 그대로를 가지고 역색인을 구성하는 것이 아니라 값을 분석하여 여러 토큰으로 쪼개고, 토큰으로 역색인을 구성한다.<li><code class="language-plaintext highlighter-rouge">term</code> : 쪼개진 토큰에 지정한 필터를 적용하는 등의 후처리 작업 후 역색인이 들어가는 형태를 말한다.</ul><h5 id="keywrod"><span class="mr-2">keywrod</span><a href="#keywrod" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>keyword로 지정된 필드에 들어온 문자열 값은 토큰으로 쪼개지 않고, 역색인을 구성한다.<li>애널라이저가로 분석하는 대신 노멀라이저를 적용한다.<li>노멀라이저는 간단한 전처리만을 거친 뒤 커다란 단일 term으로 역색인을 구성한다.</ul><h5 id="text와-keyword의-차이점"><span class="mr-2">text와 keyword의 차이점</span><a href="#text와-keyword의-차이점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>### doc 추가
PUT /mapping_test/_doc/3
Host: localhost:9200
Content-Type: application/json

{
  "keywordString" : "Hello, World!",
  "textString" : "Hello, World!"
}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### textString 검색
GET /mapping_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "match": {
      "textString": "hello"
    }
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.18232156</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mapping_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.18232156</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"keywordString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello, World!"</span><span class="p">,</span><span class="w">
		  </span><span class="nl">"textString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello, World!"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>textString으로 조회시 추가한 문서가 잘 조회되는것을 알수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### keywordString 검색
GET /mapping_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "match": {
      "keywordString": "hello"
    }
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>반면, keywordString으로 검색시에는 조회되지 않는것을 확인할 수 있다.<li>위 설명처럼 keywordString으로 문서를 찾고싶다면 정확히 일치하는 문자열로 검색을 하면 정상적으로 결과를 얻을수 있다.</ul><p><a href="https://github.com/sungsu9022/study/assets/6982740/c1f7cc99-bdf6-493e-9349-f6c478c731ef" class="popup img-link "><img width="337" alt="스크린샷 2023-11-19 오후 4 45 39" data-src="https://github.com/sungsu9022/study/assets/6982740/c1f7cc99-bdf6-493e-9349-f6c478c731ef" class="lazyload" data-proofer-ignore></a></p><ul><li>text 타입과 keyword 타입은 색인 과정에서도 위에 보이는것처럼 각각 애널라이저, 노멀라이저에 의해 색인이 이루어진다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### textString match 검색
GET /mapping_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "match": {
      "textString": "THE WORLD SAID HELLO"
    }
  }
}
</pre></table></code></div></div><p><a href="https://github.com/sungsu9022/study/assets/6982740/6553acfd-edc6-4ef7-8fef-48ef22528a33" class="popup img-link "><img width="383" alt="스크린샷 2023-11-19 오후 4 49 45" data-src="https://github.com/sungsu9022/study/assets/6982740/6553acfd-edc6-4ef7-8fef-48ef22528a33" class="lazyload" data-proofer-ignore></a></p><ul><li>추가로 text 타입의 match 질의 과정을 살펴보면 match 질의 질의어도 쪼개 생성한 4개의 텀을 역색인에서 찾는다.<li><p>위 예제에서는 world 텀과 hello 텀을 역색인에서 찾을 수 있으므로 검색 결과에 색인한 문서가 조회된다.</p><li>위 색인 방식에서 알수 있듯이 text 타입은 주로 전문 검색에 적합하고, keyworc 타입은 일치 검색에 적합하다.<li>이 두 타입은 정렬과 집계, 스크립트 작업을 수행할 때에도 동작의 차이가 있다.<ul><li>정렬과 집계, 스크립트 작업의 대상이 될 필드는 text 타입보다는 keyword 타입을 쓰는 편이 낫다.<li>keyword 타입은 doc_values라는 캐시를 사용하고, text 타입은 fielddata라는 캐시를 사용하기 때문이다. 이와 관련된 내용은 이어서 설명한다.</ul></ul><h3 id="323-doc_values"><span class="mr-2">3.2.3 doc_values</span><a href="#323-doc_values" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>ES의 검색은 역색인을 기반으로 한 색인을 이용한다.(텀을 보고 역색인에서 문서를 찾는 방식)<li>정렬, 집계, 스크립트 작업시에는 접근법이 다르다.<li>doc_values는 디스크를 기반으로 한 자료구조로 파일 시스템 캐시를 통해 효율적으로 정렬, 집계, 스크립트 작업을 수행할수 있도록 설계되었다.<li>ES에서는 text와 annotated_text 타입을 제외한 거의 모든 필드 타입이 doc_values를 지원한다.<li>doc_valuesㄱ를 끄고싶다면 맵핑 지정시 아래와 같인 속성값을 false로 할 수 있다.(doc_values가 지원되는 타입의 기본값은 true)</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>### doc_values mappaing
PUT /mapping_test/_mapping
Host: localhost:9200
Content-Type: application/json

{
  "properties": {
    "notForSort":{
      "type": "keyword",
      "doc_values": false
    }
  }
}
</pre></table></code></div></div><h3 id="324-fielddata"><span class="mr-2">3.2.4 fielddata</span><a href="#324-fielddata" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>text 타입의 경우 파일 시스템 기반의 캐시인 doc_values를 사용할 수 없다.<li>text 필드를 대상을 정렬, 집계, 스크립트 작업을 수행할 때에는 fielddata라는 캐시를 이용한다.<li>fielddata를 사용한 정렬이나 집계 등의 작업시에는 역색인 전체를 읽어들여 힙 메모리에 올려서 처리한다.<li>이런 동작 방식은 힙을 순식간에 차지해 OOM 등 많은 문제가 발생할 수 있어 기본값은 비활성화 상태이다.<li>특별한 이유가 있는 경우 이를 활성화해야 한다면 다음과 같이 mapping properties 를 지정해줄수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>###  fielddata mappaing
PUT /mapping_test/_mapping
Host: localhost:9200
Content-Type: application/json

{
  "properties": {
    "sortableText":{
      "type": "text",
      "fielddata": true
    }
  }
}
</pre></table></code></div></div><h4 id="fielddata를-사용하는-경우-주의사항"><span class="mr-2">fielddata를 사용하는 경우 주의사항</span><a href="#fielddata를-사용하는-경우-주의사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>text 필드의 fielddata를 활성화 하는 것은 매우 신중해야 한다.<li>“Hello, World!”의 역색인 텀은 이미 분석이 완료된 “hello”와 “world” 텀인데, 이를 이용해서 집계를 수행하기 떄문에 의도와 다른 결과가 나올수 있다.<li>무거운 작업으로 OOM이 발생하면 클러스터 전체에 장애를 불어올수도 있다.</ul><h4 id="doc_values-vs-fielddata"><span class="mr-2"><code class="language-plaintext highlighter-rouge">doc_values</code> vs <code class="language-plaintext highlighter-rouge">fielddata</code></span><a href="#doc_values-vs-fielddata" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="table-wrapper"><table><thead><tr><th> <th>doc_values<th>fielddata<tbody><tr><td>적용 타입<td>text, annotated_text를 제외한 모든 타입<td>text, annotated_text<tr><td>동작 방식<td>디스크 기반이며 파일 시스템 캐시를 활용한다.<td>메모리에 역색인 내용 전체를 올린다.(OOM 유의)<tr><td>기본값<td>기본적으로 활성화<td>기본적으로 비활성화</table></div><h4 id="text-vs-keyword"><span class="mr-2"><code class="language-plaintext highlighter-rouge">text</code> vs <code class="language-plaintext highlighter-rouge">keyword</code></span><a href="#text-vs-keyword" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="table-wrapper"><table><thead><tr><th> <th>text<th>keyword<tbody><tr><td>분석<td>애널라이저로 분석하여 여러 토큰으로 쪼개진 텀을 역색인<td>노멀라이저로 전처리한 단일 텀을 역색인<tr><td>검색<td>전문 검색에 적합<td>단순 완전 일치 검색에 적합<tr><td>정렬, 집계, 스크립트<td>fielddata를 사용하므로 적합하지 않음.<td>doc_values를 사용하므로 적합함.</table></div><h3 id="325-_source"><span class="mr-2">3.2.5 _source</span><a href="#325-_source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">_source</code> 필드는 문서 색인 시점에 ES에 전달된 원본 JSON 문서를 저장하는 메타데이터 필드<li>_source 필드는 JSON 문서를 통째로 담기 때문에 디스크를 많이 사용한다.</ul><h4 id="_source-비활성화"><span class="mr-2">_source 비활성화</span><a href="#_source-비활성화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>아래처럼 mappings에 설정을 통해 메타 데이터를 저장하지 않도록 설정할 수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### _source
PUT /no_source_test
Host: localhost:9200
Content-Type: application/json

{
  "mappings": {
    "_source": {
      "enabled": false
    }
  }
}
</pre></table></code></div></div><h4 id="_source-비활성화할-경우-발생할수-있는-문제"><span class="mr-2">_source 비활성화할 경우 발생할수 있는 문제</span><a href="#_source-비활성화할-경우-발생할수-있는-문제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>update와 updated_by_query API를 이용할 수 없다.<ul><li>ES의 소개에서 이야기한것처럼 ES 세그먼트는 불변인데, 기존 문서를 삭제하고 업데이트된 새 문서를 색인하는 과정에서 _source를 참조해야 하는데 update를 이용할 수 없다.</ul><li>reindex API를 사용할 수 없다.<ul><li>reindex는 원본 인덱스에서 내용을 대상 인덱스에 새로 색인하는 작업인데, 이떄에도 _source의 원본 JSON 데이터를 읽어 재색인 작업을 수행한다.<li>reindex는 ES 운영과 데이터 관리에 있어 핵심 API이다.<li>reindex를 못하는게 _source를 비활성화 할수 없는 충분한 이유가 된다.</ul><li>ES major 버전업시 문제가 될수 있다.<ul><li>일반적으로 major version이 2 이상 차이나는 경우 읽을수 없음<li>major 버전 업그레이드 전 reindex를 수행해 예쩐에 생성된 인덱스를 재생성해야 한다.</ul></ul><h4 id="인덱스-코덱-변경"><span class="mr-2">인덱스 코덱 변경</span><a href="#인덱스-코덱-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>다른 성능을 희생하더라도 디스크 공간을 절약해야만 하는 상황이라면 _soruce의 비활성화보다는 차라리 인덱스 데이터의 압축률을 높이는 편이 낫다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### index codec 변경
PUT /codec_test
Host: localhost:9200
Content-Type: application/json

{
  "settings": {
    "index": {
      "codec": "best_compression"
    }
  }
}
</pre></table></code></div></div><ul><li>default (LZ4 압축) / best_compression( DEFLATE 압축) 중 1가지를 선택할 수 있다.<li>이 설정은 동적으로 변경이 불가능하다.</ul><h4 id="synthetic-source"><span class="mr-2">synthetic source</span><a href="#synthetic-source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>ES 8.4 부터 <code class="language-plaintext highlighter-rouge">synthetic source</code> 라는 기능이 도입되었다.<li>이를 사용하는 인덱스는 _source에 JSON 원문을 저장하지 않는데, _source 비활성화와 다른점은 _source를 읽어야 하는 떄가 되면 문서 내 각 필드의 doc_values를 모아 _source를 재조립해 동작하는 점이다.<ul><li>인덱스의 모든 필드가 doc_values를 사용하는 필드여야 한다는 제약이 있고, source를 읽어야 하는 작업의 성능이 떨어질수 있다.<li>원문 JSON과 100% 일치하지는 않을수 있음(필드명, 배열내 순서 등)</ul></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### synthetic source 지정
PUT /synthetic source_test
Host: localhost:9200
Content-Type: application/json

{
  "mappings": {
    "_source": {
      "mode": "synthetic"
    }
  }
}
</pre></table></code></div></div><h4 id="_source-관련-설정-주의사항"><span class="mr-2">_source 관련 설정 주의사항</span><a href="#_source-관련-설정-주의사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><code class="language-plaintext highlighter-rouge">_source</code>와 관련된 설정은 운영에 영향이 매우 크므로 특별한 경우에 한해 심사숙고하여 결정해야 한다.</ul><h3 id="326-index"><span class="mr-2">3.2.6 index</span><a href="#326-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>index 속성은 해당 필드의 역색인을 만들것인지를 지정한다.(기본값 true)<li>false로 설정하면 해당 필드는 역색인이 없기 떄문에 일반적인 검색 대상이 되지 않는다.<li>역색인을 생성하지 않는 것뿐이기 때문에 doc_values를 사용하는 타입의 필드라면 정렬이나 집계의 대상으로는 사용할 수 있다.<li>ES 8.1 이상부터는 index 속성을 false로 설정하는것만으로 검색 대상에서 제외되지는 않는다.<ul><li>doc_values를 사용하는 필드 타입의 경우 index가 false이더라도 역색인 대신 doc_values를 이용해 검색을 수행한다.<li>다만, doc_values는 검색을 위해 설계된 자료형이 아니므로 검색 성능이 많이 떨어진다.</ul><li>데이터 설계나 서비스 설계상 검색 대상이 될 가능성이 없거나 검색 대상이 되더라도 관리적인 목적으로 아주 가끔 소규모의 검색만 필요한 경우 index 값을 false로 지정한 성능&amp;저장공간상 이득을 볼수 있다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre>### no index
PUT /mapping_test/_mapping
Host: localhost:9200
Content-Type: application/json

{
  "properties": {
    "notSearchableText": {
      "type": "text",
      "index": false
    },
    "docValueSearchableText": {
      "type": "keyword",
      "index": false
    }
  }
}

### no index doc add
PUT /mapping_test/_doc/4
Host: localhost:9200
Content-Type: application/json

{
  "textString": "Hello, World!",
  "notSearchableText": "World, Hello!",
  "docValueSearchableText": "hello"
}

### no index search error
GET /mapping_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "match": {
      "notSearchableText": "hello"
    }
  }
}
</pre></table></code></div></div><ul><li>위와 같이 검색하게 되면 index가 없어서 검색이 불가능하다는 응답을 받게 된다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### no index doc_values search
GET /mapping_test/_search
Host: localhost:9200
Content-Type: application/json

{
  "query": {
    "match": {
      "docValueSearchableText": "hello"
    }
  }
}
</pre></table></code></div></div><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	</span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"relation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eq"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	  </span><span class="p">{</span><span class="w">
		</span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mapping_test"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
		</span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		  </span><span class="nl">"textString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello, World!"</span><span class="p">,</span><span class="w">
		  </span><span class="nl">"notSearchableText"</span><span class="p">:</span><span class="w"> </span><span class="s2">"World, Hello!"</span><span class="p">,</span><span class="w">
		  </span><span class="nl">"docValueSearchableText"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hello"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	  </span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><ul><li>반면, docValueSearchableText 를 이용하면 index가 없음에도 조회되는것을 알수 있다.</ul><h3 id="327-enabled"><span class="mr-2">3.2.7 enabled</span><a href="#327-enabled" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>enabled 설정은 object 타입의 필드에만 적용된다.<li>enabled가 false로 지정된 필드는 ES가 파싱조차 수행하지 않는다.<ul><li>_source에는 데이터가 있으나, 다른 어느곳에도 저장되지 않는다.<li>역색인을 생성하기 않으므로 검색도 불가능하다.<li>정렬이나 집계의 대상도 될수 없다.</ul></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>### endabled mapping
PUT /mapping_test/_mapping
Host: localhost:9200
Content-Type: application/json

{
  "properties": {
    "notEnabled": {
      "type": "object",
      "enabled": false
    }
  }
}

### endabled doc add
PUT /mapping_test/_doc/5
Host: localhost:9200
Content-Type: application/json

{
  "notEnabled": {
    "mixedTypeArray": [
      "hello",
      4,
      false,
      {"foo": "bar"},
      null,
      [2, "E"]
    ]
  }
}

### endabled doc add2
PUT /mapping_test/_doc/6
Host: localhost:9200
Content-Type: application/json

{
  "notEnabled": "world"
}
</pre></table></code></div></div><ul><li>서비스 설계쌍 최종적으로 데이터를 _source에서 확인만 하면 되고, 그 외 어떤 활용도 필요치 않은 필드가 있다면 enabled를 false로 지정하는것을 고려해볼 수 있다.</ul><h2 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devlog/'>DevLog</a>, <a href='/categories/elasticsearch/'>Elasticsearch</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/elasticsearch/" class="post-tag no-text-decoration" >Elasticsearch</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%20%EB%B0%94%EC%9D%B4%EB%B8%94]%203.%20%EC%9D%B8%EB%8D%B1%EC%8A%A4%20%EC%84%A4%EA%B3%84%20-%201%20-%20Sungsu's%20Tech%20Blog&url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fes-bible-3-1%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%20%EB%B0%94%EC%9D%B4%EB%B8%94]%203.%20%EC%9D%B8%EB%8D%B1%EC%8A%A4%20%EC%84%A4%EA%B3%84%20-%201%20-%20Sungsu's%20Tech%20Blog&u=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fes-bible-3-1%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fes-bible-3-1%2F&text=[%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%20%EB%B0%94%EC%9D%B4%EB%B8%94]%203.%20%EC%9D%B8%EB%8D%B1%EC%8A%A4%20%EC%84%A4%EA%B3%84%20-%201%20-%20Sungsu's%20Tech%20Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/es-bible-4-3/">[엘라스틱서치 바이블] 4. 데이터 다루기 -3(ES Client 라이브러리)</a><li><a href="/posts/es-bible-4-2/">[엘라스틱서치 바이블] 4. 데이터 다루기 -2(집계)</a><li><a href="/posts/es-bible-2/">[엘라스틱서치 바이블] 2. 엘라스틱 서치 기본 동작과 구조</a><li><a href="/posts/es-bible-3-1/">[엘라스틱서치 바이블] 3. 인덱스 설계 - 1</a><li><a href="/posts/spark-guide-6/">[스파크 완벽 가이드] 6. 다양한 데이터 타입 다루기</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/es-bible-1/"><div class="card-body"> <em class="small" data-ts="1700127840" data-df="ll" > Nov 16, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[엘라스틱서치 바이블] 1. 엘라스틱 서치 소개</h3><div class="text-muted small"><p> 1. 엘라스틱 서치 소개 Elasticsearch는 2010년 2월 샤이 베논이 아파치의 루씬 라이브러리를 기반으로 만든 분산 검색 엔진 2013년에 데이터를 손쉽게 시각화하는 Kibana와 색인 데이터 수집&amp;amp;변환을 하는 Logstash 프로젝트에 엘라스틱에 합류 엘라스틱서치는 현재 검색 엔진 분야에서 가장 각광받고 있는 시스템이다...</p></div></div></a></div><div class="card"> <a href="/posts/es-bible-2/"><div class="card-body"> <em class="small" data-ts="1700218920" data-df="ll" > Nov 17, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[엘라스틱서치 바이블] 2. 엘라스틱 서치 기본 동작과 구조</h3><div class="text-muted small"><p> 2. 엘라스틱 서치 기본 동작과 구조 엘라스틱서치의 구조를 어느정도 먼저 이해한 상태에서 상세 내용을 학습해야 전체 학습에 깊이가 생긴다. 이번 장을 마치고 나면 엘라스틱서치가 어떻게 동작하는지 큰 그림을 머릿속에 그릴수 있을것이다. 2.1 엘라스틱서치 기본 동작 빠르게 둘러보기 실습 과정에서는 기본적으로 REST API를 호출해 진...</p></div></div></a></div><div class="card"> <a href="/posts/es-bible-3-2/"><div class="card-body"> <em class="small" data-ts="1702034160" data-df="ll" > Dec 8, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[엘라스틱서치 바이블] 3. 인덱스 설계 -2</h3><div class="text-muted small"><p> 3. 인덱스 설계 -2 3.3 애널라이저와 토크나이저 이전장을 통해 text 필드의 데이터는 애널라이저를 통해 분석돼 여러 텀으로 쪼개져 색인된다는것을 배웠다. 구체적으로 애널라이저가 동작하는 과정과 ES가 자체적으로 제공하는 빌트인 애널라이저를 사용해보고 특정 상황에 맞는 커스텀 애널라이저를 적용하는 방법을 살펴보자. 애널라이저는 0개...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/es-bible-2/" class="btn btn-outline-primary" prompt="Older"><p>[엘라스틱서치 바이블] 2. 엘라스틱 서치 기본 동작과 구조</p></a> <a href="/posts/es-bible-3-2/" class="btn btn-outline-primary" prompt="Newer"><p>[엘라스틱서치 바이블] 3. 인덱스 설계 -2</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://sungsu9022.github.io/posts/es-bible-3-1/'; this.page.identifier = '/posts/es-bible-3-1/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://sungsu-parks-tech-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/sungsu9022dev">sungsu9022</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-145894105-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-145894105-1'); }); </script>
