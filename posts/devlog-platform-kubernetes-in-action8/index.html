<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기" /><meta name="author" content="sungsu park" /><meta property="og:locale" content="en" /><meta name="description" content="8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기 Downward API사용방법과 쿠버네티스 REST API 사용방법, 인증과 서버 검증을 kubectl proxy에 맡기는 방법, 컨테이너 내에서 API 서버에 접근하는 방법, 앰배서더 컨테이너 패턴의 이해, 쿠버네티스 클라이언트 라이브러리 사용방법 등을 살펴본다. 특정 파드와 컨테이너 메타데이터를 컨테이너로 전달하는 방법과 컨테이너 내에서 실행중인 애플리케이션이 쿠버네티스 API 서버와 통신해 클러스터에 배포된 리소스의 정보를 얻는 것이 얼마나 쉬운지, 이런 리소스를 생하거나 수정하는 방법을 살펴보자." /><meta property="og:description" content="8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기 Downward API사용방법과 쿠버네티스 REST API 사용방법, 인증과 서버 검증을 kubectl proxy에 맡기는 방법, 컨테이너 내에서 API 서버에 접근하는 방법, 앰배서더 컨테이너 패턴의 이해, 쿠버네티스 클라이언트 라이브러리 사용방법 등을 살펴본다. 특정 파드와 컨테이너 메타데이터를 컨테이너로 전달하는 방법과 컨테이너 내에서 실행중인 애플리케이션이 쿠버네티스 API 서버와 통신해 클러스터에 배포된 리소스의 정보를 얻는 것이 얼마나 쉬운지, 이런 리소스를 생하거나 수정하는 방법을 살펴보자." /><link rel="canonical" href="https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action8/" /><meta property="og:url" content="https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action8/" /><meta property="og:site_name" content="Sungsu’s Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-23T17:34:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기" /><meta name="twitter:site" content="@sungsu9022dev" /><meta name="twitter:creator" content="@sungsu park" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"sungsu park"},"dateModified":"2020-08-23T17:34:00+09:00","datePublished":"2020-08-23T17:34:00+09:00","description":"8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기 Downward API사용방법과 쿠버네티스 REST API 사용방법, 인증과 서버 검증을 kubectl proxy에 맡기는 방법, 컨테이너 내에서 API 서버에 접근하는 방법, 앰배서더 컨테이너 패턴의 이해, 쿠버네티스 클라이언트 라이브러리 사용방법 등을 살펴본다. 특정 파드와 컨테이너 메타데이터를 컨테이너로 전달하는 방법과 컨테이너 내에서 실행중인 애플리케이션이 쿠버네티스 API 서버와 통신해 클러스터에 배포된 리소스의 정보를 얻는 것이 얼마나 쉬운지, 이런 리소스를 생하거나 수정하는 방법을 살펴보자.","headline":"[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action8/"},"url":"https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action8/"}</script><title>[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기 | Sungsu's Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sungsu's Tech Blog"><meta name="application-name" content="Sungsu's Tech Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/personal/sunny.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Sungsu's Tech Blog</a></div><div class="site-subtitle font-italic">Java/Kotlin Spring, Back-end</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/sungsu9022" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/sungsu9022dev" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['sungsu9022','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1598171640" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 23, 2020 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4973 words"> <em>27 min</em> read</span></div></div></div><div class="post-content"><h1 id="8-애플리케이션에서-파드-메타데이터와-그-외의-리소스에-엑세스하기">8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기</h1><blockquote><p>Downward API사용방법과 쿠버네티스 REST API 사용방법, 인증과 서버 검증을 kubectl proxy에 맡기는 방법, 컨테이너 내에서 API 서버에 접근하는 방법, 앰배서더 컨테이너 패턴의 이해, 쿠버네티스 클라이언트 라이브러리 사용방법 등을 살펴본다.</p><ul><li>특정 파드와 컨테이너 메타데이터를 컨테이너로 전달하는 방법과 컨테이너 내에서 실행중인 애플리케이션이 쿠버네티스 API 서버와 통신해 클러스터에 배포된 리소스의 정보를 얻는 것이 얼마나 쉬운지, 이런 리소스를 생하거나 수정하는 방법을 살펴보자.</ul></blockquote><h2 id="81-downward-api로-메타데이터-전달"><span class="mr-2">8.1 Downward API로 메타데이터 전달</span><a href="#81-downward-api로-메타데이터-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>파드의 IP, 호스트 노드 이름, 파드 자체의 이름과 같이 실행 시점까지 알려지지 않은 데이터는 어떻게 얻어와야할까?<li>이러한 정보들을 여러 곳에서 반복해서 설정하는건 말이 안된다.<li>위 2가지 문제는 쿠버네티스의 Downward API를 사용하면 해결할 수 있다.<li>Downward API는 애플리케이션이 호출해서 데이터를 가져오는 REST 엔드포인트와는 다르다.<li>파드 매니페스트에 정의한 메타 데이터를 기준으로 volume을 정의하고 이를 환경변수에 할당하여 사용할 수 있다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90978257-7c7af500-e587-11ea-8fc2-481d19ab510d.png" class="popup img-link "><img width="539" alt="스크린샷 2020-08-23 오후 9 27 39" data-src="https://user-images.githubusercontent.com/6982740/90978257-7c7af500-e587-11ea-8fc2-481d19ab510d.png" class="lazyload" data-proofer-ignore></a></p><h3 id="811-사용-가능한-메타데이터-이해"><span class="mr-2">8.1.1 사용 가능한 메타데이터 이해</span><a href="#811-사용-가능한-메타데이터-이해" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Downward API를 사용하면 파드 자체의 메타데이터를 해당 파드 내에서 실행중인 프로세스에 노출시킬 수 있다.<li>이러한 데이터는 OS로 직접 얻을수도 있겠지만, Downward API는 더 간단한 대안을 제공한다.</ul><h4 id="메타데이터-종류"><span class="mr-2">메타데이터 종류</span><a href="#메타데이터-종류" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>파드의 이름<li>파드의 IP 주소<li>파드가 속한 네임스페이스<li>파드가 실행중인 노드의 이름<li>파드가 실행중인 서비스 어카운트 이름 ( 일단 파드가 API 서버와 통신할 때 인증하는 계정 정도로 이해하면 된다.)<li>각 컨테이너의 CPU와 메모리 요청<li>각 컨테이너의 CPU와 메모리 제한<li>파드의 레이블<li>파드의 어노테이션</ul><h3 id="812-환경변수로-메타데이터-노출하기"><span class="mr-2">8.1.2 환경변수로 메타데이터 노출하기</span><a href="#812-환경변수로-메타데이터-노출하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>환경변수로 파드와 컨테이너의 메타데이터를 컨테이너에 전달하는 방법</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">downward</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">main</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">9999999"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">15m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">100Ki</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">20Mi</span>                       <span class="c1"># 메모리 사이즈 4Mi로는 파드가 안뜨고 20으로 올려줘야 정상동작( https://github.com/kubernetes/minikube/issues/6160 )</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAME</span>                       <span class="c1"># 특정 값을 설정하는 대신 파드 매니페스트의 metadata.name을 참조</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAMESPACE</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_IP</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">status.podIP</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NODE_NAME</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">SERVICE_ACCOUNT</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.serviceAccountName</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CONTAINER_CPU_REQUEST_MILLICORES</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">resourceFieldRef</span><span class="pi">:</span>                     <span class="c1"># 컨테이너의 CPU/메모리 요청과 제한은 fieldRef 대신 resourceFieldRef를 사용해 참조</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s">requests.cpu</span>
          <span class="na">divisor</span><span class="pi">:</span> <span class="s">1m</span>                         <span class="c1"># 리소스 필드의 경우 필요한 단위의 값을 얻으려면 제수(divisor)을 정의한다.</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CONTAINER_MEMORY_LIMIT_KIBIBYTES</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">resourceFieldRef</span><span class="pi">:</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s">limits.memory</span>
          <span class="na">divisor</span><span class="pi">:</span> <span class="s">1Ki</span>
</pre></table></code></div></div><ul><li>제수는 어떤 수를 나누는 수라는 뜻으로 위에서 CPU 메모리 요청의 용량 단위</ul><p><a href="https://user-images.githubusercontent.com/6982740/90978351-42f6b980-e588-11ea-897b-44e69cfb7b58.png" class="popup img-link "><img width="644" alt="스크린샷 2020-08-23 오후 9 33 13" data-src="https://user-images.githubusercontent.com/6982740/90978351-42f6b980-e588-11ea-897b-44e69cfb7b58.png" class="lazyload" data-proofer-ignore></a></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c"># downward API를 사용하는 pod 생성</span>
kubectl create <span class="nt">-f</span> downward-api-env.yaml

<span class="c"># pod의 env 조회</span>
kubectl <span class="nb">exec </span>downward <span class="nb">env

</span><span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="nv">HOSTNAME</span><span class="o">=</span>downward
<span class="nv">POD_NAMESPACE</span><span class="o">=</span>default
<span class="nv">POD_IP</span><span class="o">=</span>172.17.0.4
<span class="nv">NODE_NAME</span><span class="o">=</span>minikube
<span class="nv">SERVICE_ACCOUNT</span><span class="o">=</span>default
<span class="nv">CONTAINER_CPU_REQUEST_MILLICORES</span><span class="o">=</span>15
<span class="nv">CONTAINER_MEMORY_LIMIT_KIBIBYTES</span><span class="o">=</span>20480
<span class="nv">POD_NAME</span><span class="o">=</span>downward
<span class="nv">KUBERNETES_PORT_443_TCP_PROTO</span><span class="o">=</span>tcp
<span class="nv">KUBERNETES_PORT_443_TCP_PORT</span><span class="o">=</span>443
<span class="nv">KUBIA_PORT</span><span class="o">=</span>tcp://10.102.194.76:80
<span class="nv">KUBIA_PORT_80_TCP_ADDR</span><span class="o">=</span>10.102.194.76
<span class="nv">KUBERNETES_PORT_443_TCP</span><span class="o">=</span>tcp://10.96.0.1:443
<span class="nv">KUBERNETES_PORT_443_TCP_ADDR</span><span class="o">=</span>10.96.0.1
<span class="nv">KUBIA_SERVICE_HOST</span><span class="o">=</span>10.102.194.76
<span class="nv">KUBIA_PORT_80_TCP</span><span class="o">=</span>tcp://10.102.194.76:80
<span class="nv">KUBERNETES_PORT</span><span class="o">=</span>tcp://10.96.0.1:443
<span class="nv">KUBIA_SERVICE_PORT</span><span class="o">=</span>80
<span class="nv">KUBIA_PORT_80_TCP_PORT</span><span class="o">=</span>80
<span class="nv">KUBERNETES_SERVICE_HOST</span><span class="o">=</span>10.96.0.1
<span class="nv">KUBERNETES_SERVICE_PORT</span><span class="o">=</span>443
<span class="nv">KUBERNETES_SERVICE_PORT_HTTPS</span><span class="o">=</span>443
<span class="nv">KUBIA_PORT_80_TCP_PROTO</span><span class="o">=</span>tcp
<span class="nv">HOME</span><span class="o">=</span>/root
</pre></table></code></div></div><h3 id="813-downwardapi-볼륨에-파일로-메타데이터-전달"><span class="mr-2">8.1.3 downwardAPI 볼륨에 파일로 메타데이터 전달</span><a href="#813-downwardapi-볼륨에-파일로-메타데이터-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>환경변수 대신 파일로 메타데이터를 노출하려는 경우 downwwardAPI 볼륨을 정의해서 컨테이너에 마운트할 수 있다.<li>downward라는 볼륨을 정의하고 컨테이너의 /etc/downward 아래에 마운트하는 예제</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">downward</span>
  <span class="na">labels</span><span class="pi">:</span>                          <span class="c1"># 이 레이블과 어노테이션은 downwardAPI 볼륨으로 노출된다.</span>
    <span class="na">foo</span><span class="pi">:</span> <span class="s">bar</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">key1</span><span class="pi">:</span> <span class="s">value1</span>
    <span class="na">key2</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">multi</span>
      <span class="s">line</span>
      <span class="s">value</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">main</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">9999999"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">15m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">100Ki</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">20Mi</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>                   <span class="c1"># downward 볼륨 /etc/downward에 마운트</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">downward</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/downward</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">downward</span>                  <span class="c1"># downwardAPI 볼륨 정의</span>
    <span class="na">downwardAPI</span><span class="pi">:</span>
      <span class="na">items</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">podName"</span>             <span class="c1">#  metadata.name에  정의한 이름은 podName 파일에 기록된다.</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">podNamespace"</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">labels"</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.labels</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">annotations"</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.annotations</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">containerCpuRequestMilliCores"</span>
        <span class="na">resourceFieldRef</span><span class="pi">:</span>
          <span class="na">containerName</span><span class="pi">:</span> <span class="s">main</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s">requests.cpu</span>
          <span class="na">divisor</span><span class="pi">:</span> <span class="s">1m</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">containerMemoryLimitBytes"</span>
        <span class="na">resourceFieldRef</span><span class="pi">:</span>
          <span class="na">containerName</span><span class="pi">:</span> <span class="s">main</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s">limits.memory</span>
          <span class="na">divisor</span><span class="pi">:</span> <span class="m">1</span>
</pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/6982740/90978616-1e034600-e58a-11ea-8456-cae5e1d73bc7.png" class="popup img-link "><img width="584" alt="스크린샷 2020-08-23 오후 9 46 32" data-src="https://user-images.githubusercontent.com/6982740/90978616-1e034600-e58a-11ea-8456-cae5e1d73bc7.png" class="lazyload" data-proofer-ignore></a></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># pod 생성</span>
kubectl create <span class="nt">-f</span> downward-api-volume.yaml

<span class="c"># pod 데이터 확인</span>
kubectl <span class="nb">exec </span>downward <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-al</span> /etc/downward/
kubectl <span class="nb">exec </span>downward <span class="nt">--</span> <span class="nb">cat</span> /etc/downward/labels
kubectl <span class="nb">exec </span>downward <span class="nt">--</span> <span class="nb">cat</span> /etc/downward/annotations
</pre></table></code></div></div><h4 id="레이블과-어노테이션-업데이트"><span class="mr-2">레이블과 어노테이션 업데이트</span><a href="#레이블과-어노테이션-업데이트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>파드가 실행되는 동안 레이블, 어노테이션 값을 업데이트될 수 있다.<li>downwardAPI 볼륨을 이용하는 경우에는 업데이트시에도 최신 데이터를 볼수 있다.<li>환경변수를 사용하는 경우에는 나중에 업데이트할 수 없다.</ul><h4 id="볼륨-스펙에서-컨테이너-수준의-메타데이터-참조"><span class="mr-2">볼륨 스펙에서 컨테이너 수준의 메타데이터 참조</span><a href="#볼륨-스펙에서-컨테이너-수준의-메타데이터-참조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>리소스 제한 또는 요청(resourceFieldRef)과 같은 컨테이너 수준의 메타데이터를 노출하는 경우 리소스 필드를 참조하는 컨테이너의 이름을 필수로 지정해야 한다.(컨테이너가 하나인 파드에서도 필수 지정)<li>볼륨이 컨테이너가 아니라 파드 수준에서 정의되었지만, 리소스 제한은 컨테이너 기준이기 때문<li>환경변수를 사용하는 것보다 약간 더 복잡하지만 필요할 경우 한 컨테이너의 리소스 필드를 다른 컨테이너에 전달할 수 있는 장점이 있다.<li>환경변수로는 컨테이너 자신의 리소스 제한과 요청만 전달할 수 있다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="na">spec</span><span class="pi">:</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">downward</span>
    <span class="na">downwardAPI</span><span class="pi">:</span>
      <span class="na">items</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">containerCpuRequestMilliCores"</span>
        <span class="na">resourceFieldRef</span><span class="pi">:</span>
          <span class="na">containerName</span><span class="pi">:</span> <span class="s">main</span>           <span class="c1"># 컨테이너 이름이 필수로 지정되어야 한다.</span>
          <span class="na">resource</span><span class="pi">:</span> <span class="s">requests.cpu</span>
          <span class="na">divisor</span><span class="pi">:</span> <span class="s">1m</span>
</pre></table></code></div></div><h4 id="downward-api-사용-시기-이해"><span class="mr-2">Downward API 사용 시기 이해</span><a href="#downward-api-사용-시기-이해" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Downward API를 사용하면 애플리케이션은 쿠버네티스에 독립적으로 유지할 수 있게 한다.(기존에 환경변수의 특정 데이터를 활용하고 있는 경우 유용할 수도 있다.)<li>Downward API로 가져올 수 없는 다른 데이터들이 필요한 경우 쿠버네티스 API를 통해 가져와야 한다.</ul><h2 id="82-쿠버네티스-api-서버와-통신하기"><span class="mr-2">8.2 쿠버네티스 API 서버와 통신하기</span><a href="#82-쿠버네티스-api-서버와-통신하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Downward API는 단지 파드 자체의 메타데이터와 모든 파드의 데이터 중 일부만 노출한다.<li>애플리케이션에서 클러스터에 정의된 다른 파드나 리소스에 대한 정보가 필요한 경우도 있는데 이 경우에는 쿠버네티스 API를 이용해야 한다.</ul><h3 id="821-쿠버네티스-rest-api-살펴보기"><span class="mr-2">8.2.1 쿠버네티스 REST API 살펴보기</span><a href="#821-쿠버네티스-rest-api-살펴보기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># 쿠버네티스 클러스터 정보 조회</span>
kubectl cluster-info

Kubernetes master is running at https://192.168.64.2:8443
KubeDNS is running at https://192.168.64.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

<span class="c"># 호출 ( Forbidden 403 에러)</span>
curl https://192.168.64.2:8443 <span class="nt">-k</span>
</pre></table></code></div></div><h4 id="kubectl-proxy로-api-서버-엑세스하기"><span class="mr-2">kubectl proxy로 API 서버 엑세스하기</span><a href="#kubectl-proxy로-api-서버-엑세스하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
</pre><td class="rouge-code"><pre><span class="c"># proxy 실행</span>
kubectl proxy

<span class="c"># local proxy 호출</span>
curl http://localhost:8001


<span class="o">{</span>
  <span class="s2">"paths"</span>: <span class="o">[</span>
    <span class="s2">"/api"</span>,
    <span class="s2">"/api/v1"</span>,          <span class="c"># 대부분의 리소스 타입을 여기서 확인</span>
    <span class="s2">"/apis"</span>,
    <span class="s2">"/apis/"</span>,
    <span class="s2">"/apis/admissionregistration.k8s.io"</span>,
    <span class="s2">"/apis/admissionregistration.k8s.io/v1"</span>,
    <span class="s2">"/apis/admissionregistration.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/apiextensions.k8s.io"</span>,
    <span class="s2">"/apis/apiextensions.k8s.io/v1"</span>,
    <span class="s2">"/apis/apiextensions.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/apiregistration.k8s.io"</span>,
    <span class="s2">"/apis/apiregistration.k8s.io/v1"</span>,
    <span class="s2">"/apis/apiregistration.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/apps"</span>,
    <span class="s2">"/apis/apps/v1"</span>,
    <span class="s2">"/apis/authentication.k8s.io"</span>,
    <span class="s2">"/apis/authentication.k8s.io/v1"</span>,
    <span class="s2">"/apis/authentication.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/authorization.k8s.io"</span>,
    <span class="s2">"/apis/authorization.k8s.io/v1"</span>,
    <span class="s2">"/apis/authorization.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/autoscaling"</span>,
    <span class="s2">"/apis/autoscaling/v1"</span>,
    <span class="s2">"/apis/autoscaling/v2beta1"</span>,
    <span class="s2">"/apis/autoscaling/v2beta2"</span>,
    <span class="s2">"/apis/batch"</span>,
    <span class="s2">"/apis/batch/v1"</span>,
    <span class="s2">"/apis/batch/v1beta1"</span>,
    <span class="s2">"/apis/certificates.k8s.io"</span>,
    <span class="s2">"/apis/certificates.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/coordination.k8s.io"</span>,
    <span class="s2">"/apis/coordination.k8s.io/v1"</span>,
    <span class="s2">"/apis/coordination.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/discovery.k8s.io"</span>,
    <span class="s2">"/apis/discovery.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/events.k8s.io"</span>,
    <span class="s2">"/apis/events.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/extensions"</span>,
    <span class="s2">"/apis/extensions/v1beta1"</span>,
    <span class="s2">"/apis/networking.k8s.io"</span>,
    <span class="s2">"/apis/networking.k8s.io/v1"</span>,
    <span class="s2">"/apis/networking.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/node.k8s.io"</span>,
    <span class="s2">"/apis/node.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/policy"</span>,
    <span class="s2">"/apis/policy/v1beta1"</span>,
    <span class="s2">"/apis/rbac.authorization.k8s.io"</span>,
    <span class="s2">"/apis/rbac.authorization.k8s.io/v1"</span>,
    <span class="s2">"/apis/rbac.authorization.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/scheduling.k8s.io"</span>,
    <span class="s2">"/apis/scheduling.k8s.io/v1"</span>,
    <span class="s2">"/apis/scheduling.k8s.io/v1beta1"</span>,
    <span class="s2">"/apis/storage.k8s.io"</span>,
    <span class="s2">"/apis/storage.k8s.io/v1"</span>,
    <span class="s2">"/apis/storage.k8s.io/v1beta1"</span>,
    <span class="s2">"/healthz"</span>,
    <span class="s2">"/healthz/autoregister-completion"</span>,
    <span class="s2">"/healthz/etcd"</span>,
    <span class="s2">"/healthz/log"</span>,
    <span class="s2">"/healthz/ping"</span>,
    <span class="s2">"/healthz/poststarthook/apiservice-openapi-controller"</span>,
    <span class="s2">"/healthz/poststarthook/apiservice-registration-controller"</span>,
    <span class="s2">"/healthz/poststarthook/apiservice-status-available-controller"</span>,
    <span class="s2">"/healthz/poststarthook/bootstrap-controller"</span>,
    <span class="s2">"/healthz/poststarthook/crd-informer-synced"</span>,
    <span class="s2">"/healthz/poststarthook/generic-apiserver-start-informers"</span>,
    <span class="s2">"/healthz/poststarthook/kube-apiserver-autoregistration"</span>,
    <span class="s2">"/healthz/poststarthook/rbac/bootstrap-roles"</span>,
    <span class="s2">"/healthz/poststarthook/scheduling/bootstrap-system-priority-classes"</span>,
    <span class="s2">"/healthz/poststarthook/start-apiextensions-controllers"</span>,
    <span class="s2">"/healthz/poststarthook/start-apiextensions-informers"</span>,
    <span class="s2">"/healthz/poststarthook/start-cluster-authentication-info-controller"</span>,
    <span class="s2">"/healthz/poststarthook/start-kube-aggregator-informers"</span>,
    <span class="s2">"/healthz/poststarthook/start-kube-apiserver-admission-initializer"</span>,
    <span class="s2">"/livez"</span>,
    <span class="s2">"/livez/autoregister-completion"</span>,
    <span class="s2">"/livez/etcd"</span>,
    <span class="s2">"/livez/log"</span>,
    <span class="s2">"/livez/ping"</span>,
    <span class="s2">"/livez/poststarthook/apiservice-openapi-controller"</span>,
    <span class="s2">"/livez/poststarthook/apiservice-registration-controller"</span>,
    <span class="s2">"/livez/poststarthook/apiservice-status-available-controller"</span>,
    <span class="s2">"/livez/poststarthook/bootstrap-controller"</span>,
    <span class="s2">"/livez/poststarthook/crd-informer-synced"</span>,
    <span class="s2">"/livez/poststarthook/generic-apiserver-start-informers"</span>,
    <span class="s2">"/livez/poststarthook/kube-apiserver-autoregistration"</span>,
    <span class="s2">"/livez/poststarthook/rbac/bootstrap-roles"</span>,
    <span class="s2">"/livez/poststarthook/scheduling/bootstrap-system-priority-classes"</span>,
    <span class="s2">"/livez/poststarthook/start-apiextensions-controllers"</span>,
    <span class="s2">"/livez/poststarthook/start-apiextensions-informers"</span>,
    <span class="s2">"/livez/poststarthook/start-cluster-authentication-info-controller"</span>,
    <span class="s2">"/livez/poststarthook/start-kube-aggregator-informers"</span>,
    <span class="s2">"/livez/poststarthook/start-kube-apiserver-admission-initializer"</span>,
    <span class="s2">"/logs"</span>,
    <span class="s2">"/metrics"</span>,
    <span class="s2">"/openapi/v2"</span>,
    <span class="s2">"/readyz"</span>,
    <span class="s2">"/readyz/autoregister-completion"</span>,
    <span class="s2">"/readyz/etcd"</span>,
    <span class="s2">"/readyz/log"</span>,
    <span class="s2">"/readyz/ping"</span>,
    <span class="s2">"/readyz/poststarthook/apiservice-openapi-controller"</span>,
    <span class="s2">"/readyz/poststarthook/apiservice-registration-controller"</span>,
    <span class="s2">"/readyz/poststarthook/apiservice-status-available-controller"</span>,
    <span class="s2">"/readyz/poststarthook/bootstrap-controller"</span>,
    <span class="s2">"/readyz/poststarthook/crd-informer-synced"</span>,
    <span class="s2">"/readyz/poststarthook/generic-apiserver-start-informers"</span>,
    <span class="s2">"/readyz/poststarthook/kube-apiserver-autoregistration"</span>,
    <span class="s2">"/readyz/poststarthook/rbac/bootstrap-roles"</span>,
    <span class="s2">"/readyz/poststarthook/scheduling/bootstrap-system-priority-classes"</span>,
    <span class="s2">"/readyz/poststarthook/start-apiextensions-controllers"</span>,
    <span class="s2">"/readyz/poststarthook/start-apiextensions-informers"</span>,
    <span class="s2">"/readyz/poststarthook/start-cluster-authentication-info-controller"</span>,
    <span class="s2">"/readyz/poststarthook/start-kube-aggregator-informers"</span>,
    <span class="s2">"/readyz/poststarthook/start-kube-apiserver-admission-initializer"</span>,
    <span class="s2">"/readyz/shutdown"</span>,
    <span class="s2">"/version"</span>
  <span class="o">]</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="배치-api-그룹의-rest-엔드포인트-살펴보기"><span class="mr-2">배치 api 그룹의 REST 엔드포인트 살펴보기</span><a href="#배치-api-그룹의-rest-엔드포인트-살펴보기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c"># apis/batch 엔드포인트 조회</span>
curl http://localhost:8001/apis/batch

<span class="o">{</span>
  <span class="s2">"kind"</span>: <span class="s2">"APIGroup"</span>,
  <span class="s2">"apiVersion"</span>: <span class="s2">"v1"</span>,
  <span class="s2">"name"</span>: <span class="s2">"batch"</span>,
  <span class="s2">"versions"</span>: <span class="o">[</span>                         <span class="c"># 제공되는 groupVersion 종류(batch API그룹은 2가지 버전을 갖는다는것을 의미함)</span>
    <span class="o">{</span>
      <span class="s2">"groupVersion"</span>: <span class="s2">"batch/v1"</span>,
      <span class="s2">"version"</span>: <span class="s2">"v1"</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"groupVersion"</span>: <span class="s2">"batch/v1beta1"</span>,
      <span class="s2">"version"</span>: <span class="s2">"v1beta1"</span>
    <span class="o">}</span>
  <span class="o">]</span>,
  <span class="s2">"preferredVersion"</span>: <span class="o">{</span>                  <span class="c"># 클라이언트는 preferredVersion을 사용하는것을 권장한다는 의미</span>
    <span class="s2">"groupVersion"</span>: <span class="s2">"batch/v1"</span>,
    <span class="s2">"version"</span>: <span class="s2">"v1"</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="c"># batch/v1 리소스 유형</span>
curl http://localhost:8001/apis/batch/v1

<span class="o">{</span>
  <span class="s2">"kind"</span>: <span class="s2">"APIResourceList"</span>,         <span class="c"># batch/v1 API 그룹 내의 API 리소스 목록</span>
  <span class="s2">"apiVersion"</span>: <span class="s2">"v1"</span>,
  <span class="s2">"groupVersion"</span>: <span class="s2">"batch/v1"</span>,
  <span class="s2">"resources"</span>: <span class="o">[</span>                     <span class="c"># 이 그룹의 모든 리소스 유형을 담는 배열</span>
    <span class="o">{</span>
      <span class="s2">"name"</span>: <span class="s2">"jobs"</span>,
      <span class="s2">"singularName"</span>: <span class="s2">""</span>,
      <span class="s2">"namespaced"</span>: <span class="nb">true</span>,            <span class="c"># 네임스페이스에 속하는 리소스라는 의미 ( persistentvolumes같은 것들은 false)</span>
      <span class="s2">"kind"</span>: <span class="s2">"Job"</span>,
      <span class="s2">"verbs"</span>: <span class="o">[</span>                     <span class="c"># 이 리소스와 함꼐 사용할 수 있는 제공되는 API(단일, 여러개를 한꺼번에 추가 삭제할수 있고, 검색, 감시 업데이트 할수 있음)</span>
        <span class="s2">"create"</span>,
        <span class="s2">"delete"</span>,
        <span class="s2">"deletecollection"</span>,
        <span class="s2">"get"</span>,
        <span class="s2">"list"</span>,
        <span class="s2">"patch"</span>,
        <span class="s2">"update"</span>,
        <span class="s2">"watch"</span>
      <span class="o">]</span>,
      <span class="s2">"categories"</span>: <span class="o">[</span>
        <span class="s2">"all"</span>
      <span class="o">]</span>,
      <span class="s2">"storageVersionHash"</span>: <span class="s2">"mudhfqk/qZY="</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"name"</span>: <span class="s2">"jobs/status"</span>,       <span class="c"># 리소스의 상태를 수정하기 위한 특수한 REST 엔드포인트</span>
      <span class="s2">"singularName"</span>: <span class="s2">""</span>,
      <span class="s2">"namespaced"</span>: <span class="nb">true</span>,
      <span class="s2">"kind"</span>: <span class="s2">"Job"</span>,
      <span class="s2">"verbs"</span>: <span class="o">[</span>
        <span class="s2">"get"</span>,
        <span class="s2">"patch"</span>,
        <span class="s2">"update"</span>
      <span class="o">]</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="클러스터-안에-있는-모든-잡-인스턴스-나열하기"><span class="mr-2">클러스터 안에 있는 모든 잡 인스턴스 나열하기</span><a href="#클러스터-안에-있는-모든-잡-인스턴스-나열하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>items 하위에 나열된다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># job 생성</span>
kubectl create <span class="nt">-f</span> my-job.yaml

<span class="c"># 모든 잡 인스턴스 조회</span>
curl http://localhost:8001/apis/batch/v1/jobs
</pre></table></code></div></div><h4 id="이름별로-특정-잡-인스턴스-검색"><span class="mr-2">이름별로 특정 잡 인스턴스 검색</span><a href="#이름별로-특정-잡-인스턴스-검색" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># api를 통한 job 조회</span>
curl http://localhost:8001/apis/batch/v1/namespaces/default/jobs/my-job

<span class="c"># job 정보 조회</span>
kubectl get job my-job <span class="nt">-o</span> json

<span class="c"># 위 2가지 결과는 같다.</span>
</pre></table></code></div></div><h3 id="822-파드-내에서-api-서버와-통신"><span class="mr-2">8.2.2 파드 내에서 API 서버와 통신</span><a href="#822-파드-내에서-api-서버와-통신" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>파드 내에서 통신하려면 API 서버의 위치를 찾아야하고, 서버로 인증을 해야 한다.</ul><h4 id="api-서버와의-통신을-시도하기-위해-파드-실행"><span class="mr-2">API 서버와의 통신을 시도하기 위해 파드 실행</span><a href="#api-서버와의-통신을-시도하기-위해-파드-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>kubectl create <span class="nt">-f</span> curl.yaml

<span class="c"># 파드의 shell 접근</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl bash

</pre></table></code></div></div><h4 id="api-서버-주소-찾기"><span class="mr-2">API 서버 주소 찾기</span><a href="#api-서버-주소-찾기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>실제 애플리케이션에서는 서버 인증서 확인을 절대로 건너뛰면 안된다. 중간자 공격(man-in-the-middle attack)으로 인증 토큰을 공격자에게 노출할수 있기 때문<ul><li>중간자 공격(man-in-the-middle attack)은 통신을 연결하는 두 사람 사이에 중간자가 침입해 두 사람은 상대방에 연결했다고 생각하지만 실제로는 두 사람은 중간자에게 연결돼 있으며, 중간자가 한쪽에서 전달된 정보를 도청 및 조작한 후 다른쪽으로 전달하는 방식</ul></ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c"># kubernetes 서비스</span>
kubectl get svc

<span class="c"># KUBERNETES_SERVICE_HOST, KUBERNETES_SERVICE_PORT 변수를 통해 얻을수 있다.</span>
<span class="nb">env</span> | <span class="nb">grep </span>KUBERNETES_SERVICE

<span class="nv">KUBERNETES_SERVICE_PORT</span><span class="o">=</span>443
<span class="nv">KUBERNETES_SERVICE_HOST</span><span class="o">=</span>10.96.0.1
<span class="nv">KUBERNETES_SERVICE_PORT_HTTPS</span><span class="o">=</span>443

<span class="c"># FQDN을 이용한 방법(403)</span>
curl https://kubernetes <span class="nt">-k</span>
</pre></table></code></div></div><h4 id="서버의-아이덴티티-검증"><span class="mr-2">서버의 아이덴티티 검증</span><a href="#서버의-아이덴티티-검증" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>각 컨테이너의 /var/run/secrets/kubernetes.io/serviceaccount/에 마운트되는 자동 생성된 default-token-xyz 라는 이름의 시크릿을 기준으로 처리할수 있다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c"># 컨테이너 내부에서 조회</span>
<span class="nb">ls</span> /var/run/secrets/kubernetes.io/serviceaccount/

ca.crt	namespace  token

<span class="c"># --cacert 옵션을 통해 인증서 지정 ( 여전히 403)</span>
curl <span class="nt">--cacert</span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt https://kubernetes

<span class="c"># 환경변수 지정</span>
<span class="nb">export </span><span class="nv">CURL_CA_BUNDLE</span><span class="o">=</span>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt

<span class="c"># 재호출</span>
curl https://kubernetes
</pre></table></code></div></div><h4 id="api-서버로-인증"><span class="mr-2">API 서버로 인증</span><a href="#api-서버로-인증" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Authorization HTTP 헤더 내부에 토큰을 전달하여 토큰을 인증된 것으로 인식하여 적절한 응답을 받을 수 있다.<li>이런 방식을 통해 네임스페이스 내에 있는 모든 파드를 조회할 수 있다. 그러나 먼저 curl 파드가 어떤 네임스페이서에서 실행중인지 알아야 한다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> /var/run/secrets/kubernetes.io/serviceaccount/token<span class="si">)</span>

<span class="c"># 호출  ( 왜안되느지 모르겠지만 안됨 ㅠ)</span>
curl <span class="nt">-H</span> <span class="s2">"Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">"</span> https://kubernetes
</pre></table></code></div></div><h4 id="역할-기반-엑세스-제어rbac-비활성화"><span class="mr-2">역할 기반 엑세스 제어(RBAC) 비활성화</span><a href="#역할-기반-엑세스-제어rbac-비활성화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>RBAC가 활성화된 쿠버네티스 클러스터를 사용하는 경우 서비스 어카운트가 API 서버에 엑세스할 권한이 없을 수 있다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># 모든 서비스 어카운트에 클러스터 관리자 권한이 부여됨</span>
kubectl create clusterrolebinding permissive-binding <span class="nt">--clusterrole</span><span class="o">=</span>cluster-admin <span class="nt">--group</span><span class="o">=</span>system:serviceaccounts

<span class="c"># 위험하고 프로덕션 클러스터에서는 해서는 안됨.</span>
</pre></table></code></div></div><h4 id="파드가-실행중인-네임스페이스-얻기"><span class="mr-2">파드가 실행중인 네임스페이스 얻기</span><a href="#파드가-실행중인-네임스페이스-얻기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>시크릿 볼륨 디렉터리에 있는 3개의 파일을 사용해 파드와 동일한 네임스페이스에서 실행중인 모든 파드를 나열할 수 있다.<li>GET 대신 PUT이나 PATCH를 전송해 업데이트도 가능하다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># namespace 지정 ( 실제로 default인데 아무값도 없다..)</span>
<span class="nv">NS</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> /var/run/secrets/kubernetes.io/serviceaccount/namespace<span class="si">)</span>

<span class="c"># 호출</span>
curl <span class="nt">-H</span> <span class="s2">"Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">"</span> https://kubernetes/api/v/namespaces/<span class="nv">$NS</span>/pods
</pre></table></code></div></div><h4 id="파드가-쿠버네티스와-통신하는-방법-정리"><span class="mr-2">파드가 쿠버네티스와 통신하는 방법 정리</span><a href="#파드가-쿠버네티스와-통신하는-방법-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>애플리케이션 API 서버의 인증서가 인증기관으로부터 서명됐는지를 검증해야 하고, 인증 기관의 인증서는 ca.cart 파일에 있다.<li>애플리케이션은 token 파일의 내용을 Authorization HTTP 헤더에 Bearer 토큰으로 넣어 전송해서 자신을 인증해야 한다.<li>namespace 파일은 파드의 네임스페이스 안에 있는 API 오브젝트의 CRUD 작업을 수행할 때 네임스페이스를 API 서버로 전달하는데 사용해야 한다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90980181-cae2c080-e594-11ea-9c01-59946ba4ece6.png" class="popup img-link "><img width="575" alt="스크린샷 2020-08-23 오후 11 02 49" data-src="https://user-images.githubusercontent.com/6982740/90980181-cae2c080-e594-11ea-9c01-59946ba4ece6.png" class="lazyload" data-proofer-ignore></a></p><h3 id="823-앰배서더-컨테이너를-이용한-api-서버-통신-간소화"><span class="mr-2">8.2.3 앰배서더 컨테이너를 이용한 API 서버 통신 간소화</span><a href="#823-앰배서더-컨테이너를-이용한-api-서버-통신-간소화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>보안을 유지하면서 통신을 훨씬 간단하게 만들수 있다.(kubectl proxy 활용)</ul><h4 id="앰배서더-컨테이너-패턴-소개"><span class="mr-2">앰배서더 컨테이너 패턴 소개</span><a href="#앰배서더-컨테이너-패턴-소개" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>메인 컨테이너 옆의 앰배서더 컨테이너에서 kubectl proxy를 실행하고 이를 통해 APi 서버와 통신할 수 있다.<li>메인 컨테이너의 애플리케이션은 HTTPS 대신 HTTP로 앰배서더에 연결하고 앰배서더 프록시가 APi 서버에 대한 HTtPS 연결을 처리하도록해 보안을 투명하게 관리할 수 있다.<li>파드의 모든 컨테이너는 동일한 루프백 네트워크 인터페이스를 공유하므로 애플리케이션은 localhost의 포트로 프록세이 엑세스할 수 있다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90980192-e8178f00-e594-11ea-9768-db60048e3bc9.png" class="popup img-link "><img width="474" alt="스크린샷 2020-08-23 오후 11 03 46" data-src="https://user-images.githubusercontent.com/6982740/90980192-e8178f00-e594-11ea-9768-db60048e3bc9.png" class="lazyload" data-proofer-ignore></a></p><h4 id="추가적인-앰배서더-컨테이너를-사용한-curl-파드-실행"><span class="mr-2">추가적인 앰배서더 컨테이너를 사용한 curl 파드 실행</span><a href="#추가적인-앰배서더-컨테이너를-사용한-curl-파드-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>kubectl proxy는 8001에 바인딩되며 curl localhost:8001에 접속할 수 있다.<li>외부 서비스에 연결하는 복잡성을 숨기고 메인 컨테이너에서 실행되는 애플리케이션을 단순화하기 위해 앰배서더 컨테이너를 사용하는 좋은 예시이다.<li>단점은 추가 프로세스를 실행해야 해서 리소스가 추가로 소비된다는 것이다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">curl-with-ambassador</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">main</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">tutum/curl</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">9999999"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ambassador</span>                             <span class="c1"># kubectl-proxy 이미지를 실행하는 앰배서더 컨테이너</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/kubectl-proxy:1.6.2</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c"># pod 생성</span>
kubectl create <span class="nt">-f</span> curl-with-ambassador.yaml


<span class="c"># shell 접속</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-with-ambassador <span class="nt">-c</span> main bash

<span class="c"># 호출</span>
curl localhost:8001
</pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/6982740/90980360-b9e67f00-e595-11ea-81e0-4118cbe6ad08.png" class="popup img-link "><img width="577" alt="스크린샷 2020-08-23 오후 11 09 33" data-src="https://user-images.githubusercontent.com/6982740/90980360-b9e67f00-e595-11ea-81e0-4118cbe6ad08.png" class="lazyload" data-proofer-ignore></a></p><h3 id="824-클라이언트-라이브러리를-사용해-api-서버와-통신"><span class="mr-2">8.2.4 클라이언트 라이브러리를 사용해 API 서버와 통신</span><a href="#824-클라이언트-라이브러리를-사용해-api-서버와-통신" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>단순한 API 요청 이상을 수행하려면 쿠버네티스 API 클라이언트 라이브러리 중 하나를 사용하는 것이 좋다.<li><a href="https://kubernetes.io/ko/docs/reference/using-api/client-libraries/">https://kubernetes.io/ko/docs/reference/using-api/client-libraries/</a> ( 다양한 언어를 지원함.)<li>현재 SIG(Special Interest Group)에서 지원하는 API는 Go, Python, Java ,.net, JavaScript, Haskell이 있다.<li>이 라이브러리를 사용하는 경우 기본적으로 HTTPS를 지원하고, 인증을 관리하므로 앰배서더 컨테이너를 사용할 필요가 없다.</ul><h4 id="java-예제--httpsgithubcomkubernetes-clientjava-"><span class="mr-2">Java 예제 ( https://github.com/kubernetes-client/java/ )</span><a href="#java-예제--httpsgithubcomkubernetes-clientjava-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>책에 있는 Fabric8 java 클라이언트가 아니라 SIG에서 지원하는 Java 클라이언트 라이브러리를 첨부</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">// list all pods</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ApiException</span><span class="o">{</span>
        <span class="nc">ApiClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">Config</span><span class="o">.</span><span class="na">defaultClient</span><span class="o">();</span>
        <span class="nc">Configuration</span><span class="o">.</span><span class="na">setDefaultApiClient</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>

        <span class="nc">CoreV1Api</span> <span class="n">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CoreV1Api</span><span class="o">();</span>
       <span class="c1">// 라이브러리 메소드 설계는 좀 이상하게 해놓은듯, 모두 null이면 arguments 정의를 안했어야지..)</span>
        <span class="nc">V1PodList</span> <span class="n">list</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">listPodForAllNamespaces</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">V1Pod</span> <span class="n">item</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getItems</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getMetadata</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// watch on namespace object:</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WatchExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ApiException</span><span class="o">{</span>
        <span class="nc">ApiClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">Config</span><span class="o">.</span><span class="na">defaultClient</span><span class="o">();</span>
        <span class="nc">Configuration</span><span class="o">.</span><span class="na">setDefaultApiClient</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>

        <span class="nc">CoreV1Api</span> <span class="n">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CoreV1Api</span><span class="o">();</span>

        <span class="nc">Watch</span><span class="o">&lt;</span><span class="nc">V1Namespace</span><span class="o">&gt;</span> <span class="n">watch</span> <span class="o">=</span> <span class="nc">Watch</span><span class="o">.</span><span class="na">createWatch</span><span class="o">(</span>
                <span class="n">client</span><span class="o">,</span>
                <span class="n">api</span><span class="o">.</span><span class="na">listNamespaceCall</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">TRUE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">),</span>
                <span class="k">new</span> <span class="nc">TypeToken</span><span class="o">&lt;</span><span class="nc">Watch</span><span class="o">.</span><span class="na">Response</span><span class="o">&lt;</span><span class="nc">V1Namespace</span><span class="o">&gt;&gt;(){}.</span><span class="na">getType</span><span class="o">());</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">Watch</span><span class="o">.</span><span class="na">Response</span><span class="o">&lt;</span><span class="nc">V1Namespace</span><span class="o">&gt;</span> <span class="n">item</span> <span class="o">:</span> <span class="n">watch</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%s : %s%n"</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">type</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">object</span><span class="o">.</span><span class="na">getMetadata</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="스웨거와-open-api를-사용해-자신의-라이브러리-구축"><span class="mr-2">스웨거와 Open API를 사용해 자신의 라이브러리 구축</span><a href="#스웨거와-open-api를-사용해-자신의-라이브러리-구축" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>쿠버네티스 API 서버는 /swaggerapi 에서 스웨거 API 정의를 공개하고 /swagger.json에서 OepnAPI 스펙을 공개하고 있다.</ul><h4 id="스웨거-ui로-api-살펴보기"><span class="mr-2">스웨거 UI로 API 살펴보기</span><a href="#스웨거-ui로-api-살펴보기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>스웨거 UI로 REST API를 더 나은 방식으로 탐색할 수 있다.<li>API 서버를 <code class="language-plaintext highlighter-rouge">--enable-swagger-ui=true</code>옵션으로 실행하면 활성화된다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c"># minikube swaggerUI = true 적용</span>
minikube start <span class="nt">--extra-config</span><span class="o">=</span>apiserver.Features.EnableSwaggerUI<span class="o">=</span><span class="nb">true</span>


<span class="c"># kubectl proxy</span>
kubectl proxy <span class="nt">--port</span><span class="o">=</span>8080 &amp;

<span class="c"># 호출 ( swagger-ui 안됨..)</span>
http://localhost:8080/swagger-ui
http://localhost:8080/swagger.json
http://192.168.64.2:8443/swagger-ui

</pre></table></code></div></div><h2 id="83-요약"><span class="mr-2">8.3 요약</span><a href="#83-요약" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>파드의 이름, 네임스페이스 및 기타 메타데이터가 환경변수 또는 downward API 볼륨의 파일로 컨테이너 내부의 프로세스에 노출시키는 방법<li>CPU와 메모리의 요청 및 제한이 필요한 단위로 애플리케이션에 전달되는 방법<li>파드에서 downward API 볼륨을 사용해 파드가 살아 있는 동안 변경될 수 있는 최신 메타데이터를 얻는 방법(레이블과 어노테이션 등)<li>kubectl proxy로 쿠버네티스 REST API를 탐색하는 방법<li>쿠버네티스에 정의된 다른 서비스와 같은 방식으로 파드가 환경변수 또는 DNS로 API 서버의 위치를 찾는 방법<li>파드에서 실행되는 애플리케이션이 API 서버와 통신하는지 검증하고, 자신을 인증하는 방법<li>앰배서더 컨테이너를 사용해 애플리케이션 내에서 API 서버와 훨씬 간단하게 통신하는 방법<li>클라이언트 라이브러리ㅏ로 쉽게 쿠버네티스와 상호작용할 수 있는 방법</ul><h2 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://www.manning.com/books/kubernetes-in-action">kubernetes-in-action</a><li><a href="https://kubernetes.io/ko/docs/home/">kubernetes.io</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devlog/'>DevLog</a>, <a href='/categories/kubernetes/'>kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/infra/" class="post-tag no-text-decoration" >Infra</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/kubernetes-in-action/" class="post-tag no-text-decoration" >kubernetes-in-action</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-in-action]%208.%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%97%90%EC%84%9C%20%ED%8C%8C%EB%93%9C%20%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%99%80%20%EA%B7%B8%20%EC%99%B8%EC%9D%98%20%EB%A6%AC%EC%86%8C%EC%8A%A4%EC%97%90%20%EC%97%91%EC%84%B8%EC%8A%A4%ED%95%98%EA%B8%B0%20-%20Sungsu's%20Tech%20Blog&url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fdevlog-platform-kubernetes-in-action8%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-in-action]%208.%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%97%90%EC%84%9C%20%ED%8C%8C%EB%93%9C%20%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%99%80%20%EA%B7%B8%20%EC%99%B8%EC%9D%98%20%EB%A6%AC%EC%86%8C%EC%8A%A4%EC%97%90%20%EC%97%91%EC%84%B8%EC%8A%A4%ED%95%98%EA%B8%B0%20-%20Sungsu's%20Tech%20Blog&u=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fdevlog-platform-kubernetes-in-action8%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fdevlog-platform-kubernetes-in-action8%2F&text=[kubernetes-in-action]%208.%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%97%90%EC%84%9C%20%ED%8C%8C%EB%93%9C%20%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%99%80%20%EA%B7%B8%20%EC%99%B8%EC%9D%98%20%EB%A6%AC%EC%86%8C%EC%8A%A4%EC%97%90%20%EC%97%91%EC%84%B8%EC%8A%A4%ED%95%98%EA%B8%B0%20-%20Sungsu's%20Tech%20Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/es-bible-4-3/">[엘라스틱서치 바이블] 4. 데이터 다루기 -3(ES Client 라이브러리)</a><li><a href="/posts/es-bible-4-2/">[엘라스틱서치 바이블] 4. 데이터 다루기 -2(집계)</a><li><a href="/posts/es-bible-2/">[엘라스틱서치 바이블] 2. 엘라스틱 서치 기본 동작과 구조</a><li><a href="/posts/es-bible-3-1/">[엘라스틱서치 바이블] 3. 인덱스 설계 - 1</a><li><a href="/posts/spark-guide-6/">[스파크 완벽 가이드] 6. 다양한 데이터 타입 다루기</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/devlog-platform-kubernetes-in-action1/"><div class="card-body"> <em class="small" data-ts="1596270840" data-df="ll" > Aug 1, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-in-action] 1. 쿠버네티스 소개</h3><div class="text-muted small"><p> 1. 쿠버네티스 소개 쿠버네티스 등장 배경 거대한 모놀리스 레거시 애플리케이션은 점차 마이크로 서비스라는 독립적으로 실행되는 더 작은 구성 요소로 세분화되고 있다. 마이크로 서비스는 서루 분리돼 있기 떄문에 개별적으로 개발, 배포, 업데이트, 확장할 수 있다. 이로써 오늘날 급변하는 비즈니스 요구사항을 충족시킬 만큼 신속하게 자주 구성 요소를 변...</p></div></div></a></div><div class="card"> <a href="/posts/devlog-platform-kubernetes-in-action2/"><div class="card-body"> <em class="small" data-ts="1596357240" data-df="ll" > Aug 2, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-in-action] 2. 도커와 쿠버네티스 첫걸음</h3><div class="text-muted small"><p> 2. 도커와 쿠버네티스 첫걸음 2.1 도커를 사용한 컨테이너 이미지 생성, 실행, 공유하기 2.1.1 Hello World 컨테이너 실행하기 docker run busybox echp &quot;Hello world&quot; 백그라운드에 일어난 동작 이해하기 docker run 명령을 수행했을 떄 일어나는 일들 2.1.2 간단한 node.js 애플리...</p></div></div></a></div><div class="card"> <a href="/posts/devlog-platform-kubernetes-in-action3/"><div class="card-body"> <em class="small" data-ts="1596443640" data-df="ll" > Aug 3, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-in-action] 3. 파드 : 쿠버네티스에서 컨테이너 실행</h3><div class="text-muted small"><p> 3. 파드 : 쿠버네티스에서 컨테이너 실행 3.1 파드 소개 파드는 함께 배치된 컨테이너 그룹이며, 쿠버네티스의 기본 빌딩 블록. 컨테이너를 개별적으로 배포하기보다는 컨테이너를 가진 파드를 배포하고, 운영한다. 무조건 2개 이상을 컨테이너를 포함시키라는 의미는 아니고 일반적으로는 하나의 컨테이너만 포함된다. 파드의 핵심은 파드가 여러 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/devlog-platform-kubernetes-in-action7/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정</p></a> <a href="/posts/devlog-platform-kubernetes-in-action9/" class="btn btn-outline-primary" prompt="Newer"><p>[kubernetes-in-action] 9. 디플로이먼트 : 선언적 애플리케이션 업데이트</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action8/'; this.page.identifier = '/posts/devlog-platform-kubernetes-in-action8/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://sungsu-parks-tech-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/sungsu9022dev">sungsu9022</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-145894105-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-145894105-1'); }); </script>
