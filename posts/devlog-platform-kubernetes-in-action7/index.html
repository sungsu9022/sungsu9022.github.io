<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정" /><meta name="author" content="sungsu park" /><meta property="og:locale" content="en" /><meta name="description" content="7. 컨피그맵과 시크릿 : 애플리케이션 설정 빌드된 애플리케이션 자체에 포함되지 말아야 하는 설정(배포된 인스턴스별로 다른 세팅, 외부 시스템 엑세스를 위한 자격증명 등)이 필요하다. 쿠버네티스는 이런 앱을 실행할때 설정 옵션을 전달할수 있는 방법을 제공한다." /><meta property="og:description" content="7. 컨피그맵과 시크릿 : 애플리케이션 설정 빌드된 애플리케이션 자체에 포함되지 말아야 하는 설정(배포된 인스턴스별로 다른 세팅, 외부 시스템 엑세스를 위한 자격증명 등)이 필요하다. 쿠버네티스는 이런 앱을 실행할때 설정 옵션을 전달할수 있는 방법을 제공한다." /><link rel="canonical" href="https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action7/" /><meta property="og:url" content="https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action7/" /><meta property="og:site_name" content="Sungsu’s Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-22T17:34:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정" /><meta name="twitter:site" content="@sungsu9022dev" /><meta name="twitter:creator" content="@sungsu park" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"sungsu park"},"dateModified":"2020-08-22T17:34:00+09:00","datePublished":"2020-08-22T17:34:00+09:00","description":"7. 컨피그맵과 시크릿 : 애플리케이션 설정 빌드된 애플리케이션 자체에 포함되지 말아야 하는 설정(배포된 인스턴스별로 다른 세팅, 외부 시스템 엑세스를 위한 자격증명 등)이 필요하다. 쿠버네티스는 이런 앱을 실행할때 설정 옵션을 전달할수 있는 방법을 제공한다.","headline":"[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정","mainEntityOfPage":{"@type":"WebPage","@id":"https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action7/"},"url":"https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action7/"}</script><title>[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정 | Sungsu's Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sungsu's Tech Blog"><meta name="application-name" content="Sungsu's Tech Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/personal/sunny.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Sungsu's Tech Blog</a></div><div class="site-subtitle font-italic">Java/Kotlin Spring, Back-end</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/sungsu9022" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/sungsu9022dev" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['sungsu9022','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[kubernetes-in-action] 7. 컨피그맵과 시크릿 : 애플리케이션 설정</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1598085240" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 22, 2020 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7091 words"> <em>39 min</em> read</span></div></div></div><div class="post-content"><h1 id="7-컨피그맵과-시크릿--애플리케이션-설정">7. 컨피그맵과 시크릿 : 애플리케이션 설정</h1><blockquote><p>빌드된 애플리케이션 자체에 포함되지 말아야 하는 설정(배포된 인스턴스별로 다른 세팅, 외부 시스템 엑세스를 위한 자격증명 등)이 필요하다. 쿠버네티스는 이런 앱을 실행할때 설정 옵션을 전달할수 있는 방법을 제공한다.</p></blockquote><h2 id="71-컨테이너화된-애플리케이션-설정"><span class="mr-2">7.1 컨테이너화된 애플리케이션 설정</span><a href="#71-컨테이너화된-애플리케이션-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>필요한 모든 설정을 앱에 포함하는 경우를 제외하면 일반적으로 명령줄 인수를 통해 앱에 필요한 설정을 넘겨주면서 앱을 실행시킨다.<li>옵션 목록이 커지면 이 옵션들을 파일에 저장하고 사용하기도 한다.<li>아니면 서버의 환경변수를 통해 전달하기도 한다.<li>도커 컨테이너를 기반으로 한다고 했을때 내부에 있는 설정 파일을 사용하는것은 약간 까다롭다.(컨테이너 이미지 안에 넣는것은 소스코드에 하드코딩하는것과 다를바가 없음)<li>인증 정보나 암호화 키와 같이 비밀로 유지해야 하는 내용을 포함하게 되면 해당 이미지에 접근할 수 있는 모든 사람은 누구나 정보를 볼수 있게 되버린다.<li>쿠버네티스에서는 설정 데이터를 최상위 레벨의 쿠버네티스 오브젝트에 저장하고 이를 기타 다른 리소스 정의와 마찬가지로 깃 저장소 혹은 다른 파일 기반 스토리지에 저장할 수 있다.<li>이러한 목적으로 쿠버네티스는 컨피그맵이라는 리소스를 제공한다.<li>대부분의 설정 옵션에서는 민감한 정보가 포함돼있지 않지만, 자격증명, 개인 암호화 키, 보안을 유지해야 하는 유사한 데이터들도 있다. 이를 위한 시크릿이라는 또다른 유형의 오브젝트도 제공한다.</ul><h3 id="애플리케이션에-설정을-전달하는-방법"><span class="mr-2">애플리케이션에 설정을 전달하는 방법</span><a href="#애플리케이션에-설정을-전달하는-방법" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>컨테이너에 명령줄 인수 전달<li>각 컨테이너를 위한 사용자 정의 환경변수 지정<li>특수한 유형의 볼륨을 통해 설정</ul><h2 id="72-컨테이너에-명령줄-인자-전달"><span class="mr-2">7.2 컨테이너에 명령줄 인자 전달</span><a href="#72-컨테이너에-명령줄-인자-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="721-도커에서-명령어와-인자-정의"><span class="mr-2">7.2.1 도커에서 명령어와 인자 정의</span><a href="#721-도커에서-명령어와-인자-정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="entrypoint와-cmd-이해"><span class="mr-2">ENTRYPOINT와 CMD 이해</span><a href="#entrypoint와-cmd-이해" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>ENTRYPOINT는 컨테이너가 시작될때 호출될 명령어 정의<li>CMD는 ENTRYPOINT에 전달되는 인자를 정의</ul><h4 id="shell과-exec-형식간의-차이점"><span class="mr-2">shell과 exec 형식간의 차이점</span><a href="#shell과-exec-형식간의-차이점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>shell 형식 : ENTRYPOINT node app.js</ul><p><a href="https://user-images.githubusercontent.com/6982740/90649119-4bdc4800-e275-11ea-8c4e-d4a3142d1a23.png" class="popup img-link "><img width="400" alt="스크린샷 2020-08-19 오후 11 39 55" data-src="https://user-images.githubusercontent.com/6982740/90649119-4bdc4800-e275-11ea-8c4e-d4a3142d1a23.png" class="lazyload" data-proofer-ignore></a></p><ul><li>exec 형식 : ENTRYPOINT [“node”, “app.js”]</ul><p><a href="https://user-images.githubusercontent.com/6982740/90649077-3ff08600-e275-11ea-91a0-118cb55a8682.png" class="popup img-link "><img width="329" alt="스크린샷 2020-08-19 오후 11 39 16" data-src="https://user-images.githubusercontent.com/6982740/90649077-3ff08600-e275-11ea-91a0-118cb55a8682.png" class="lazyload" data-proofer-ignore></a></p><h4 id="fortune-이미지에서-간격을-설정할-수-있도록-만들기"><span class="mr-2">fortune 이미지에서 간격을 설정할 수 있도록 만들기</span><a href="#fortune-이미지에서-간격을-설정할-수-있도록-만들기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>INTERVAL 변수를 추가하고 첫 번쨰 명령줄 인자의 값으로 초기화</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c"># fortuneloop.sh</span>
<span class="c">#!/bin/bash</span>
<span class="nb">trap</span> <span class="s2">"exit"</span> SIGINT

<span class="nv">INTERVAL</span><span class="o">=</span><span class="nv">$1</span>        <span class="c"># 인자</span>
<span class="nb">echo </span>Configured to generate new fortune every <span class="nv">$INTERVAL</span> seconds

<span class="nb">mkdir</span> <span class="nt">-p</span> /var/htdocs

<span class="k">while</span> :
<span class="k">do
  </span><span class="nb">echo</span> <span class="si">$(</span><span class="nb">date</span><span class="si">)</span> Writing fortune to /var/htdocs/index.html
  /usr/games/fortune <span class="o">&gt;</span> /var/htdocs/index.html
  <span class="nb">sleep</span> <span class="nv">$INTERVAL</span>
<span class="k">done</span>
</pre></table></code></div></div><div class="language-dockerfile highlighter-rouge"><div class="code-header"> <span data-label-text="Dockerfile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># Dockerfile</span>
<span class="k">FROM</span><span class="s"> ubuntu:latest</span>

<span class="k">RUN </span>apt-get update <span class="p">;</span> apt-get <span class="nt">-y</span> <span class="nb">install </span>fortune
<span class="k">ADD</span><span class="s"> fortuneloop.sh /bin/fortuneloop.sh</span>

<span class="k">ENTRYPOINT</span><span class="s"> ["/bin/fortuneloop.sh"]    # exec 형태의 ENTRYPOINT 명령</span>
<span class="k">CMD</span><span class="s"> ["10"]                                                # 실행할때 사용할 기본 인자</span>
</pre></table></code></div></div><h3 id="722-쿠버네티스에서-명령과-인자-재정의"><span class="mr-2">7.2.2 쿠버네티스에서 명령과 인자 재정의</span><a href="#722-쿠버네티스에서-명령과-인자-재정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>command와 args 필드로 맵핑된다. 이는 파드 생성 이후에는 업데이트 할수 없다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune2s</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">some/image</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin"</span><span class="nv">/commend"</span><span class="pi">]</span>
    <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">arg1"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">arg2"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">arg3"</span><span class="pi">]</span>
</pre></table></code></div></div><h4 id="사용자-정의-주기로-fortune-파드-실행"><span class="mr-2">사용자 정의 주기로 fortune 파드 실행</span><a href="#사용자-정의-주기로-fortune-파드-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune2s</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:args</span>
    <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">2"</span><span class="pi">]</span>                               <span class="c1"># 스크립트가 2초마다 새로운 fortune 메시지를 생성하도록 인자 지정</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><h4 id="여러개의-인자-처리"><span class="mr-2">여러개의 인자 처리</span><a href="#여러개의-인자-처리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>    <span class="na">args</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">foo</span>
     <span class="pi">-</span> <span class="s">bar</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">15"</span>
</pre></table></code></div></div><h4 id="숫자-인자에-대한-처리"><span class="mr-2">숫자 인자에 대한 처리</span><a href="#숫자-인자에-대한-처리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>문자열인 경우는 ““로 묶을 필요 없지만 숫자는 묶어야 한다.</ul><h2 id="73-컨테이너의-환경변수-설정"><span class="mr-2">7.3 컨테이너의 환경변수 설정</span><a href="#73-컨테이너의-환경변수-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>파드의 각 컨테이너를 위한 환경변수 리스트를 지정할 수 있다.<li>컨테이너 명령이나 인자와 마찬가지로 환경변수 목록도 파드 생성 후에는 업데이트 불가<li>컨테이너별로 다른 환경변수 설정도 가능하다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90651055-94950080-e277-11ea-90b2-c228586c38b0.png" class="popup img-link "><img width="253" alt="스크린샷 2020-08-19 오후 11 56 13" data-src="https://user-images.githubusercontent.com/6982740/90651055-94950080-e277-11ea-90b2-c228586c38b0.png" class="lazyload" data-proofer-ignore></a></p><h3 id="환경변수로-fortune-이미지-안에-간격을-설정할-수-있도록-만들기"><span class="mr-2">환경변수로 fortune 이미지 안에 간격을 설정할 수 있도록 만들기</span><a href="#환경변수로-fortune-이미지-안에-간격을-설정할-수-있도록-만들기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>변수 초기화하는 부분을 제거하면 끝.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="nb">trap</span> <span class="s2">"exit"</span> SIGINT

<span class="nb">echo </span>Configured to generate new fortune every <span class="nv">$INTERVAL</span> seconds

<span class="nb">mkdir</span> <span class="nt">-p</span> /var/htdocs

<span class="k">while</span> :
<span class="k">do
  </span><span class="nb">echo</span> <span class="si">$(</span><span class="nb">date</span><span class="si">)</span> Writing fortune to /var/htdocs/index.html
  /usr/games/fortune <span class="o">&gt;</span> /var/htdocs/index.html
  <span class="nb">sleep</span> <span class="nv">$INTERVAL</span>
<span class="k">done</span>
</pre></table></code></div></div><h3 id="731-컨테이너-정의에-환경변수-지정"><span class="mr-2">7.3.1 컨테이너 정의에 환경변수 지정</span><a href="#731-컨테이너-정의에-환경변수-지정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>각 컨테이너를 설정할 때, 쿠버네티스는 자동으로 동일한 네임스페이스 안에 있는 각 서비스에 환경변수를 노출하는것은 알고 있어야 한다.(파드에 정의한 환경변수명이 같아 덮어써지는 부분이 있을수 있어서인듯)</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-env</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:env</span>
    <span class="na">env</span><span class="pi">:</span>                                           <span class="c1"># 환경변수 목록에 단일 변수 추가</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">INTERVAL</span>
      <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">30"</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><h3 id="732-변숫값에서-다른-환경변수-참조"><span class="mr-2">7.3.2 변숫값에서 다른 환경변수 참조</span><a href="#732-변숫값에서-다른-환경변수-참조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">FIRST_VAR</span>
      <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">foo"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">SECOND_VAR</span>
      <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${FIRST_VAR}bar"</span>     <span class="c1"># foobar가 됨</span>
</pre></table></code></div></div><h3 id="733-하드코딩된-환경변수의-단점"><span class="mr-2">7.3.3 하드코딩된 환경변수의 단점</span><a href="#733-하드코딩된-환경변수의-단점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>하드코딩된 값을 가져오는게 효율적일 수 있지만, 프로덕션과 개발환경의 파드를 별도로 정의해야할수도 있다는 의미<li>여러 환경에서 동일한 파드 정의를 재사용하려면 파드 정의에서 설정을 분리하는것이 좋다.</ul><h2 id="74-컨피그맵으로-설정-분리"><span class="mr-2">7.4 컨피그맵으로 설정 분리</span><a href="#74-컨피그맵으로-설정-분리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>환경에 따라 다르거나 자주 변경되는 설정 옵션을 애플리케이션 소스 코드와 별도로 유지하는 것.</ul><h3 id="741-컨피그맵-소개"><span class="mr-2">7.4.1 컨피그맵 소개</span><a href="#741-컨피그맵-소개" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>쿠버네티스에서는 설정 옵션을 컨피그맵이라 부르는 별도 오브젝트로 분리할 수 있다.<li>짧은 문자열에서 전체 설정 파일에 이르는 값을 가지는 키/값 쌍으로 구성된 맵이다.<li>쿠버네티스 REST API 엔드포인트를 통해 컨피그맵의 내용을 직접 읽는것이 가능하지만, 반드시 필요한 경우가 아니라면 애플리케이션 내부는 쿠버네티스와 무관하도록 유지해야 한다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90973329-0ca34500-e55c-11ea-965b-3ddd2ea53d39.png" class="popup img-link "><img width="292" alt="스크린샷 2020-08-23 오후 4 16 28" data-src="https://user-images.githubusercontent.com/6982740/90973329-0ca34500-e55c-11ea-965b-3ddd2ea53d39.png" class="lazyload" data-proofer-ignore></a></p><ul><li>파드는 컨피그맵을 이름으로 참조하여 모든 환경에서 동일한 파드 정의를 사용해 각 환경에서 서로 다른 설정을 사용할 수 있다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90973361-555afe00-e55c-11ea-8213-7c313345b59a.png" class="popup img-link "><img width="507" alt="스크린샷 2020-08-23 오후 4 18 37" data-src="https://user-images.githubusercontent.com/6982740/90973361-555afe00-e55c-11ea-8213-7c313345b59a.png" class="lazyload" data-proofer-ignore></a></p><h3 id="742-컨피그맵-생성"><span class="mr-2">7.4.2 컨피그맵 생성</span><a href="#742-컨피그맵-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">sleep-interval</span><span class="pi">:</span> <span class="s2">"</span><span class="s">25"</span>
</pre></table></code></div></div><ul><li>kubectl create configmap로 생성 가능<li>컨피그맵 키는 유효한 DNS 서브도메인이어야 한다.(영숫자, 대시, 밑줄, 점만 포함 가능)</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c"># 컨피그맵 생성 (file)</span>
kubectl create <span class="nt">-f</span> fortune-config.yaml

<span class="c"># 컨피그맵 생성 (literal)</span>
kubectl create configmap fortune-config <span class="nt">--from-literal</span><span class="o">=</span>sleep-interval<span class="o">=</span>25

<span class="c"># 컨피그맵 생성 (여러개의 literal)</span>
kubectl create configmap myconfigmap <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">foo</span><span class="o">=</span>bar <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">bar</span><span class="o">=</span>baz <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">one</span><span class="o">=</span>two

<span class="c"># 컨피그맵 목록 조회</span>
kubectl get cm

<span class="c"># 컨피그맵 정의 확인</span>
kubectl get configmap fortune-config <span class="nt">-o</span> yaml
</pre></table></code></div></div><h4 id="파일-내용으로-컨피그맵-생성"><span class="mr-2">파일 내용으로 컨피그맵 생성</span><a href="#파일-내용으로-컨피그맵-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>전체 설정 파일 같은 데이터를 통째로 컨피그맵에 저장할 수 있다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># 파일 통째로 컨피그맵 생성</span>
<span class="c">#  - 파일 자체가 값으로 지정됨</span>
kubectl create configmap my-config <span class="nt">--from-file</span><span class="o">=</span>config-file.conf

<span class="c"># 파일 통째로 저장하되 customkey  지정</span>
kubectl create configmap my-config <span class="nt">--from-file</span><span class="o">=</span><span class="nv">customkey</span><span class="o">=</span>config-file.conf
</pre></table></code></div></div><h4 id="디렉터리에-있는-파일-컨피그맵-생성"><span class="mr-2">디렉터리에 있는 파일 컨피그맵 생성</span><a href="#디렉터리에-있는-파일-컨피그맵-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>kubectl create configmap my-config <span class="nt">--from-file</span><span class="o">=</span>/path/to/dir

<span class="c">#### 다양한 옵션 결합</span>
<span class="sb">```</span> sh
kubectl create configmap my-config
    <span class="nt">--from-file</span><span class="o">=</span>foo.json                  <span class="c"># 단일 파일</span>
    <span class="nt">--from-file</span><span class="o">=</span><span class="nv">bar</span><span class="o">=</span>foobar.conf    <span class="c"># 사용자 정의 키 밑에 파일 저장</span>
    <span class="nt">--from-file</span><span class="o">=</span>config-opts/          <span class="c"># 전체 디렉터리</span>
    <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">some</span><span class="o">=</span>thing       <span class="c"># 문자열 값</span>
</pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/6982740/90973560-1a59ca00-e55e-11ea-982a-364cb2fbe1a6.png" class="popup img-link "><img width="650" alt="스크린샷 2020-08-23 오후 4 31 07" data-src="https://user-images.githubusercontent.com/6982740/90973560-1a59ca00-e55e-11ea-982a-364cb2fbe1a6.png" class="lazyload" data-proofer-ignore></a></p><h3 id="743-컨피그맵-항목을-환경변수로-컨테이너에-전달"><span class="mr-2">7.4.3 컨피그맵 항목을 환경변수로 컨테이너에 전달</span><a href="#743-컨피그맵-항목을-환경변수로-컨테이너에-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>생성한 맵의 값을 어떻게 파드 안의 컨테이너를 전달할수 있는 방법을 살펴보자</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-env-from-configmap</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:env</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">INTERVAL</span>               <span class="c1"># INTERVAL 환경변수 설정</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">configMapKeyRef</span><span class="pi">:</span>            <span class="c1"># 컨피그맵 키에서 값을 가져와 초기화</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>     <span class="c1"># 참조하는 컨피그맵 이름</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">sleep-interval</span>          <span class="c1"># 컨피그맵에서 해당 키 아래에 저장된 값으로 변수 셋팅</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/6982740/90973768-0adb8080-e560-11ea-9de7-0dc283009381.png" class="popup img-link "><img width="577" alt="스크린샷 2020-08-23 오후 4 45 18" data-src="https://user-images.githubusercontent.com/6982740/90973768-0adb8080-e560-11ea-9de7-0dc283009381.png" class="lazyload" data-proofer-ignore></a></p><h4 id="파드에-존재하지-않는-컨피그맵-참조"><span class="mr-2">파드에 존재하지 않는 컨피그맵 참조</span><a href="#파드에-존재하지-않는-컨피그맵-참조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>존재하지 않는 컨피그맵을 참조하려고 하면 컨테이너는 시작하는데 실패한다.<li>하지만 참조하지 않는 다른 컨테이너는 정상적으로 시자된다. 누락된 컨피그맵을 생성하면 실패했던 컨테이너는 파드를 다시 만들지 않아도 자동으로 시작된다.<li>컨피그맵 참조를 옵션으로 표시할수도 있다. ( configMapKeyRef.optional : true로 지정), 이런 경우는 컨피그맵이 존재하지 않아도 컨테이너가 시작된다.</ul><h3 id="744-컨피그맵의-모든-항목을-한번에-환경변수로-전달"><span class="mr-2">7.4.4 컨피그맵의 모든 항목을 한번에 환경변수로 전달</span><a href="#744-컨피그맵의-모든-항목을-한번에-환경변수로-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>컨피그맵의 모든 항목을 환경변수로 노출할 수 있는 방법을 제공한다.<li>접두사는 선택사항이고, 이를 생략하면 환경변수의 이름은 키와 동일한 이름을 갖게 된다.<li>CONFIG_FOO-BAR는 대시를 가지고 있어 올바른 환경변수 이름이 아니기 때문에 이런 경우 환경변수로 변환되지 않는다.(올바른 형식이 아닌 경우 쿠버네티스에서 생략함)</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">some-image</span>
    <span class="na">envForm</span><span class="pi">:</span>                               <span class="c1"># env 대신 envForm 사용</span>
    <span class="pi">-</span> <span class="na">prefix</span><span class="pi">:</span> <span class="s">CONFIG_</span>                 <span class="c1"># 모든 환경변수는 CONFIG_ prefix로 설정됨.</span>
        <span class="na">configMapRef</span><span class="pi">:</span>                  <span class="c1"># my-config-map 이름의 컨피그맵 참조</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">my-config-map</span>
<span class="nn">...</span>
</pre></table></code></div></div><h3 id="745-컨피그맵-항목을-명령줄-인자로-전달"><span class="mr-2">7.4.5 컨피그맵 항목을 명령줄 인자로 전달</span><a href="#745-컨피그맵-항목을-명령줄-인자로-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>pod.spec.containers.args 필드에서 직접 컨피그맵 항목을 참조할 수는 없지만 컨피그맵 항목을 환경변수로 먼저 초기화하고 이 벼수를 인자로 참조할 수 있다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-args-from-configmap</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:args</span>          <span class="c1"># 환경변수가 아닌 첫번째 인자에서 간격을 가져오는 이미지</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">INTERVAL</span>                       <span class="c1"># 컨피그맵에서 환경변수 정의</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">configMapKeyRef</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">sleep-interval</span>
    <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">$(INTERVAL)"</span><span class="pi">]</span>                  <span class="c1"># 인자에 앞에서 정의한 환경변수를 지정</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/6982740/90973854-dc11da00-e560-11ea-87ae-2d60bd828f16.png" class="popup img-link "><img width="566" alt="스크린샷 2020-08-23 오후 4 51 12" data-src="https://user-images.githubusercontent.com/6982740/90973854-dc11da00-e560-11ea-87ae-2d60bd828f16.png" class="lazyload" data-proofer-ignore></a></p><h3 id="746-컨피그맵-볼륨을-사용해-컨피그맵-항목을-파일로-노출"><span class="mr-2">7.4.6 컨피그맵 볼륨을 사용해 컨피그맵 항목을 파일로 노출</span><a href="#746-컨피그맵-볼륨을-사용해-컨피그맵-항목을-파일로-노출" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>컨피그맵은 모든 설정 파일을 포함한다.<li>컨피그맵 볼륨을 사용해서도 적용할 수가 있다.<li>컨피그맵 볼륨은 파일로 컨피그맵의 각 항목을 노출한다.</ul><h4 id="컨피그맵-생성"><span class="mr-2">컨피그맵 생성</span><a href="#컨피그맵-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>nginx 서버가 클라이언트로 응답을 gzip 압축해서 보내는 니즈가 있다고 해보자.<li>nginx gzip 압축 옵션을 활성화하고 이에 대한 컨피그맵을 생성해야 한다.</ul><div class="language-conf highlighter-rouge"><div class="code-header"> <span data-label-text="Conf"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c"># nginx gzip config 정의
</span><span class="n">server</span> {
    <span class="n">listen</span>              <span class="m">80</span>;
    <span class="n">server_name</span>         <span class="n">www</span>.<span class="n">kubia</span>-<span class="n">example</span>.<span class="n">com</span>;

    <span class="n">gzip</span> <span class="n">on</span>;                                                         <span class="c"># gzip 압축 활성화
</span>    <span class="n">gzip_types</span> <span class="n">text</span>/<span class="n">plain</span> <span class="n">application</span>/<span class="n">xml</span>;

    <span class="n">location</span> / {
        <span class="n">root</span>   /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">nginx</span>/<span class="n">html</span>;
        <span class="n">index</span>  <span class="n">index</span>.<span class="n">html</span> <span class="n">index</span>.<span class="n">htm</span>;
    }
}
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># configMap 삭제</span>
kubectl delete cm fortune-config

<span class="c"># configMap dir로 생성</span>
kubectl create configmap fortune-config <span class="nt">--from-file</span><span class="o">=</span>configmap-files

<span class="c"># configMap 확인</span>
kubectl get cm fortune-config <span class="nt">-o</span> yaml
</pre></table></code></div></div><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="c1"># 컨피그맵 내용</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">my-nginx-config.conf</span><span class="pi">:</span> <span class="pi">|</span>                      <span class="c1"># 파이프라인(|) 문자는 여러 줄의 문자열이 이어진다는 것을 의미한다.</span>
    <span class="s">server {</span>
        <span class="s">listen              80;</span>
        <span class="s">server_name         www.kubia-example.com;</span>

        <span class="s">gzip on;</span>
        <span class="s">gzip_types text/plain application/xml;</span>

        <span class="s">location / {</span>
            <span class="s">root   /usr/share/nginx/html;</span>
            <span class="s">index  index.html index.htm;</span>
        <span class="s">}</span>

    <span class="s">}</span>
  <span class="na">sleep-interval</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">25</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2020-08-23T07:55:47Z"</span>
  <span class="na">managedFields</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">fieldsType</span><span class="pi">:</span> <span class="s">FieldsV1</span>
    <span class="na">fieldsV1</span><span class="pi">:</span>
      <span class="na">f:data</span><span class="pi">:</span>
        <span class="na">.</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">f:my-nginx-config.conf</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">f:sleep-interval</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">manager</span><span class="pi">:</span> <span class="s">kubectl</span>
    <span class="na">operation</span><span class="pi">:</span> <span class="s">Update</span>
    <span class="na">time</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2020-08-23T07:55:47Z"</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">resourceVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3405"</span>
  <span class="na">selfLink</span><span class="pi">:</span> <span class="s">/api/v1/namespaces/default/configmaps/fortune-config</span>
  <span class="na">uid</span><span class="pi">:</span> <span class="s">bc35aea1-618a-4961-a8ef-06136d71825c</span>
</pre></table></code></div></div><h4 id="볼륨-안에-있는-컨피그맵-항목-사용"><span class="mr-2">볼륨 안에 있는 컨피그맵 항목 사용</span><a href="#볼륨-안에-있는-컨피그맵-항목-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>컨피그맵 항목에서 생성된 파일로 볼륨을 초기화하는 방법</ul><p><a href="https://user-images.githubusercontent.com/6982740/90973957-d2d53d00-e561-11ea-9f68-bd3017f4d11a.png" class="popup img-link "><img width="512" alt="스크린샷 2020-08-23 오후 4 58 05" data-src="https://user-images.githubusercontent.com/6982740/90973957-d2d53d00-e561-11ea-9f68-bd3017f4d11a.png" class="lazyload" data-proofer-ignore></a></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-configmap-volume</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:env</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">INTERVAL</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">configMapKeyRef</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">sleep-interval</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>                                           <span class="c1"># 컨피그맵 볼륨 마운트</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>          <span class="c1"># 컨피그맵 볼륨을 마운트하는 컨테이너 위치</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/nginx/conf.d</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/tmp/whole-fortune-config-volume</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
    <span class="na">configMap</span><span class="pi">:</span>                             <span class="c1"># 이 볼륨은 fortune-config 컨피그맵을 참조하는 볼륨</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
</pre></table></code></div></div><h4 id="nginx-서버가-마운트한-설정-파일을-사용하는지-확인"><span class="mr-2">nginx 서버가 마운트한 설정 파일을 사용하는지 확인</span><a href="#nginx-서버가-마운트한-설정-파일을-사용하는지-확인" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c"># pod 생성</span>
kubectl create <span class="nt">-f</span> fortune-pod-configmap-volume.yaml

<span class="c"># port forward</span>
 kubectl port-forward fortune-configmap-volume 8080:80 &amp;

<span class="c"># reqeuest</span>
curl <span class="nt">-H</span> <span class="s2">"Accept-Encoding: gzip"</span> <span class="nt">-I</span> localhost:8080

<span class="c"># 마운트된 컨피그맵 볼륨 내용 살펴보기</span>
kubectl <span class="nb">exec </span>fortune-configmap-volume <span class="nt">-c</span> web-server <span class="nb">ls</span> /etc/nginx/conf.d
</pre></table></code></div></div><h4 id="볼륨에-특정-컨피그맵-항목-노출"><span class="mr-2">볼륨에 특정 컨피그맵 항목 노출</span><a href="#볼륨에-특정-컨피그맵-항목-노출" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>아래와 같이 설정하면 컨테이너 마운트 위치 ‘/etc/nginx/conf.d/’ 디렉터리에는 gzip.conf 파일만 포함된다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-configmap-volume-with-items</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:env</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/nginx/conf.d/</span>     <span class="c1"># 컨테이너 마운트 path</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
    <span class="na">configMap</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
      <span class="na">items</span><span class="pi">:</span>                            <span class="c1"># 볼륨에 포함할 항목을 조회해 선택</span>
      <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">my-nginx-config.conf</span>       <span class="c1"># 해당 키 아래에 항목을 포함</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">gzip.conf</span>                 <span class="c1"># 항목 값이 지정된 파일에 저장</span>
</pre></table></code></div></div><h4 id="디렉터리를-마운트할-때-디렉터리의-기존-파일을-숨기는-것에-대한-이해"><span class="mr-2">디렉터리를 마운트할 때 디렉터리의 기존 파일을 숨기는 것에 대한 이해</span><a href="#디렉터리를-마운트할-때-디렉터리의-기존-파일을-숨기는-것에-대한-이해" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>리눅스 파일시스템을 비어 있지 않은 디렉터리에 마운트할떄 발생할 수 있는 문제로, 디렉터리는 마운트한 파일시스템에 있는 파일만 포함하고, 원래 있던 파일은 해당 파일시스템이 마운트돼 있는 동안 접근할 수 없게 된다.<li>중요한 파일을 포함하는 /etc 디렉터리에 볼륨을 마운트한다고 하면 /etc 디렉터리에 있어야 하는 모든 원본 파일이 더 이상 존재하지 않게 되어 전체 컨테이너가 손상될 수 있다.</ul><h4 id="디렉터리-안에-다른-파일을-숨기지-않고-개별-컨피그맵-항목을-파일로-마운트"><span class="mr-2">디렉터리 안에 다른 파일을 숨기지 않고 개별 컨피그맵 항목을 파일로 마운트</span><a href="#디렉터리-안에-다른-파일을-숨기지-않고-개별-컨피그맵-항목을-파일로-마운트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>전체 볼륨을 마운트하는 대신 volumeMount에 subPath 속성으로 파일이나 디렉터리 하나를 볼륨에 마운트할 수 있다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90974099-04023d00-e563-11ea-8e05-648a5c6bdbfe.png" class="popup img-link "><img width="545" alt="스크린샷 2020-08-23 오후 5 06 37" data-src="https://user-images.githubusercontent.com/6982740/90974099-04023d00-e563-11ea-8e05-648a5c6bdbfe.png" class="lazyload" data-proofer-ignore></a></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">some/image</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myvolume</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/someconfig.conf</span>      <span class="c1"># 디렉터리가 아닌 파일을 마운트</span>
      <span class="na">subPath</span><span class="pi">:</span> <span class="s">myconfig.conf</span>               <span class="c1"># 전체 볼륨을 마운트하는 대신 myconfig.conf 항목만 마운트</span>
</pre></table></code></div></div><ul><li>subPath 속성은 모든 종류의 볼륨을 마운트할때 사용할 수 있다. 하지만 개별 파일을 마운트하는 이 방법은 파일 업데이트와 관ㄹ녀해 상대적으로 큰 결함을 가지고 있다.</ul><h4 id="컨피그맵-볼륨-안에-있는-파일-권한-수정"><span class="mr-2">컨피그맵 볼륨 안에 있는 파일 권한 수정</span><a href="#컨피그맵-볼륨-안에-있는-파일-권한-수정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>기본적으로 컨피그맵 볼륨의 모든 파일 권한은 644(-rw-r-r–)로 설정된다.<li>defaultMode 속성을 설정하여 변경이 가능하다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
    <span class="na">configMap</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
      <span class="na">defaultMode</span><span class="pi">:</span> <span class="m">0660</span>           <span class="c1"># 모든 파일 권한을 660(-rw-rw---) 로 설정</span>
</pre></table></code></div></div><h3 id="747-애플리케이션을-재시작하지-않고-설정-업데이트"><span class="mr-2">7.4.7 애플리케이션을 재시작하지 않고 설정 업데이트</span><a href="#747-애플리케이션을-재시작하지-않고-설정-업데이트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>컨피그맵을 사용해 볼륨으로 노출하면 파드를 다시 만들거나 컨테이너를 다시 시작할 필요 없이 설정을 업데이트할 수 있다.<li>컨피그맵을 업데이트한 후에 파일이 업데이트되기까지는 생각보다 오랜 시간이 걸릴수 있다.(최대 1분)</ul><h4 id="컨피그맵-편집"><span class="mr-2">컨피그맵 편집</span><a href="#컨피그맵-편집" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># configmap 수정</span>
kubectl edit configmap fortune-config

<span class="c"># web-server 컨테이너 내 설정파일 확인</span>
kubectl <span class="nb">exec </span>fortune-configmap-volume <span class="nt">-c</span> web-server <span class="nb">cat</span> /etc/nginx/conf.d/my-nginx-config.conf
</pre></table></code></div></div><h4 id="설정을-다시-로드하기-위해-nginx에-신호-전달"><span class="mr-2">설정을 다시 로드하기 위해 nginx에 신호 전달</span><a href="#설정을-다시-로드하기-위해-nginx에-신호-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl <span class="nb">exec </span>fortune-configmap-volume <span class="nt">-c</span> web-server <span class="nt">--</span> nginx <span class="nt">-s</span> reload
</pre></table></code></div></div><h4 id="파일이-한꺼번에-업데이트되는-방법-이해"><span class="mr-2">파일이 한꺼번에 업데이트되는 방법 이해</span><a href="#파일이-한꺼번에-업데이트되는-방법-이해" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>쿠버네티스 컨피그맵은 모든 파일이 한번에 업데이트된다. (심볼릭 링크 방식으로 동작하기 때문)</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c"># 컨테이너 디렉토리 확인</span>
kubectl <span class="nb">exec</span> <span class="nt">-i</span> <span class="nt">-t</span> fortune-configmap-volume <span class="nt">-c</span> web-server <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-al</span> /etc/nginx/conf.d

<span class="c"># 결과</span>
drwxrwxrwx    3 root     root          4096 Aug 23 08:14 <span class="nb">.</span>
drwxr-xr-x    3 root     root          4096 Aug 14 00:37 ..
drwxr-xr-x    2 root     root          4096 Aug 23 08:14 ..2020_08_23_08_14_11.042426742
lrwxrwxrwx    1 root     root            31 Aug 23 08:14 ..data -&gt; ..2020_08_23_08_14_11.042426742
lrwxrwxrwx    1 root     root            27 Aug 23 08:14 my-nginx-config.conf -&gt; ..data/my-nginx-config.conf
lrwxrwxrwx    1 root     root            21 Aug 23 08:14 sleep-interval -&gt; ..data/sleep-interval
</pre></table></code></div></div><h4 id="이미-존재하는-디렉터리에-파일만-마운트했을-때-업데이트가-되지-않는-것-이해하기"><span class="mr-2">이미 존재하는 디렉터리에 파일만 마운트했을 때 업데이트가 되지 않는 것 이해하기</span><a href="#이미-존재하는-디렉터리에-파일만-마운트했을-때-업데이트가-되지-않는-것-이해하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>단일 파일만 컨테이너에 마운트한 경우 파일이 업데이트 되지 않는다.(단순 컨피그맵 + 볼륨 기능만 이용하는 경우에 한하여)</ul><h4 id="컨피그맵-업데이트의-결과-이해하기"><span class="mr-2">컨피그맵 업데이트의 결과 이해하기</span><a href="#컨피그맵-업데이트의-결과-이해하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>컨테이너의 가장 주용한 기능은 불변성(immutability)이다.<li>앱이 설정을 다시 읽는 기능을 지원하지 않는 경우에 심각한 문제가 발생한다.<li>컨피그맵을 변경한 이후 생성된 파드는 새로운 설정을 사용하지만 예전 파드는 계속 예전 설정을 사용하기 때문.<li>애플리케이션이 설정을 자동으로 다시 읽는 기능을 가지고 있지 않다면 이미 존재하는 컨피그맵을 수정하는것은 좋은 방법이 아니다.</ul><h2 id="75-시크릿으로-민감한-데이터-컨테이너에-전달"><span class="mr-2">7.5 시크릿으로 민감한 데이터 컨테이너에 전달</span><a href="#75-시크릿으로-민감한-데이터-컨테이너에-전달" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="751-시크릿-소개"><span class="mr-2">7.5.1 시크릿 소개</span><a href="#751-시크릿-소개" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>쿠버네티스는 민감한 정보를 보관하고 배포하기 위하여 시크릿이라는 오브젝트를 제공한다.<li>시크릿은 키-값 쌍을 가진 맵으로 컨피그맵과 매우 비슷하다.<li>컨피그맵과 마찬가지로 환경변수로 시크릿 항목을 컨테이너에 전달하거나 볼륨 파일로 노출시킬 수 있다.<li>시크릿에 접근해야 하는 파드가 실행되고 있는 노드에만 개별 시크릿을 배포해 시크릿을 안전하게 유지한다.<li>노드 자체적으로 시크릿을 항상 메모리에만 저장하게 되고 물리 저장소에는 기록되지 않도록 처리한다.<li>마스터 노드의 etcd에는 시크릿을 암호화되지 않는 형식으로 저장하므로 시크릿에 저장한 민감한 데이터를 보호하려면 마스터 노드를 보호해야 한다.(쿠버네티스 1.7 이하에서만, 그 이후로는 암호화된 형태로 저장함.)</ul><h4 id="시크릿-vs-컨피그맵-어떤것을-사용해야-할지에-대한-기준"><span class="mr-2">시크릿 vs 컨피그맵 어떤것을 사용해야 할지에 대한 기준</span><a href="#시크릿-vs-컨피그맵-어떤것을-사용해야-할지에-대한-기준" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>민감하지 않고, 일반 설정 데이터는 컨피그맵을 사용하라.<li>본질적으로 민감한 데이터는 시크릿을 사용해 키 아래에 보관하는 것이 필요하다.<li>민감한 데이터와 그렇지 않는 데이터를 모두 가지고 있는 경우 해당 파일은 시크릿 안에 저장해야 한다.</ul><h3 id="752-기반-토큰-시크릿"><span class="mr-2">7.5.2 기반 토큰 시크릿</span><a href="#752-기반-토큰-시크릿" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>모든 파드에는 sercret 볼륨이 자동으로 연결되어 있다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="na">Containers</span><span class="pi">:</span>        <span class="c1"># default-token (Secret) 마운트</span>
    <span class="na">Mounts</span><span class="pi">:</span>
      <span class="s">/var/run/secrets/kubernetes.io/serviceaccount from default-token-xkr6d (ro)</span>

<span class="na">Volumes</span><span class="pi">:</span>
  <span class="na">default-token-xkr6d</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span>        <span class="s">Secret (a volume populated by a Secret)</span>
    <span class="na">SecretName</span><span class="pi">:</span>  <span class="s">default-token-xkr6d</span>
    <span class="na">Optional</span><span class="pi">:</span>    <span class="kc">false</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># pod 정보 조회</span>
kubectl describe po kubia-8pw7z

<span class="c"># 시크릿 리소스 조회</span>
kubectl get secrets

<span class="c"># 시크릿 정보 조회</span>
kubectl describe secrets
</pre></table></code></div></div><ul><li>시크릿이 갖고 있는 3가지 항목(ca.crt, namespace, token)은 파드 안에서 쿠버네티스 API 서버와 통신할 때 필요한 것이다.<li>기본적으로 default-token 시크릿은 모든 컨테이너에 마운트된다.<li>파드 스펙 안에 auto mountService-AccountToken 필드 값을 false로 지정하거나 파드가 사용하는 서비스 어카운트를 false로 지정해 비활성화할 수 있다.</ul><p><a href="https://user-images.githubusercontent.com/6982740/90974536-44fc5080-e567-11ea-9dd1-0b77f396ae57.png" class="popup img-link "><img width="523" alt="스크린샷 2020-08-23 오후 5 37 00" data-src="https://user-images.githubusercontent.com/6982740/90974536-44fc5080-e567-11ea-9dd1-0b77f396ae57.png" class="lazyload" data-proofer-ignore></a></p><h3 id="753-시크릿-생성"><span class="mr-2">7.5.3 시크릿 생성</span><a href="#753-시크릿-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># 인증서와 개인키 생성</span>
openssl genrsa <span class="nt">-out</span> https.key 2048
openssl req <span class="nt">-new</span> <span class="nt">-x509</span> <span class="nt">-key</span> https.key <span class="nt">-out</span> https.cert <span class="nt">-days</span> 3650 <span class="nt">-subj</span> /CN<span class="o">=</span>www.kubia-example.com

<span class="c"># secret 생성 ( fortune-https 이름을 가진 generic 시크릿을 생성 )</span>
kubectl create secret generic fortune-https <span class="nt">--from-file</span><span class="o">=</span>https.key <span class="nt">--from-file</span><span class="o">=</span>https.cert <span class="nt">--from-file</span><span class="o">=</span>foo
</pre></table></code></div></div><h4 id="시크릿의-유형"><span class="mr-2">시크릿의 유형</span><a href="#시크릿의-유형" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>docker-registry ( 도커 레지스트리 사용을 위한)<li>tls ( TLS 통신을 위한)<li>generic (일반적인 상황)</ul><h3 id="754-컨피그맵과-시크릿-비교"><span class="mr-2">7.5.4 컨피그맵과 시크릿 비교</span><a href="#754-컨피그맵과-시크릿-비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>시크릿 항목의 내용은 base64 인코딩 문자열로 표시되고, 컨피그맵의 내용은 일반 텍스트로 표시된다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># 시크릿 조회</span>
kubectl get secret fortune-https <span class="nt">-o</span> yaml

<span class="c"># 컨피그맵 조회</span>
kubectl get configmap fortune-config <span class="nt">-o</span> yaml
</pre></table></code></div></div><h4 id="바이너리-데이터-시크릿-사용"><span class="mr-2">바이너리 데이터 시크릿 사용</span><a href="#바이너리-데이터-시크릿-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>base64 인코딩을 사용하는 이유는 일반 텍스트 뿐만 아니라 바이너리 값도 담을 수 있기 때문이다.<li>민감하지 않은 데이터도 시크릿을 사용할수 있지만 시크릿의 최대 크기는 1MB로 제한된다.</ul><h4 id="stringdata-필드-소개"><span class="mr-2">stringData 필드 소개</span><a href="#stringdata-필드-소개" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>쿠버네티스는 시크릿의 값을 stringData 필드로 설정할 수 있게 해준다.<li>stringData 필드는 쓰기 전용이다.(값을 설정할 때만 사용 가능)</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="s">stringData</span>                <span class="c1"># 바이너리 데이터가 아닌 시크릿 데이터에 사용할 수 있다.</span>
  <span class="na">foo</span><span class="pi">:</span> <span class="s">plain text</span>         <span class="c1"># "plain text"는 base64 인코딩되지 않는다.</span>
<span class="na">data</span><span class="pi">:</span>
   <span class="na">https.cert</span><span class="pi">:</span> <span class="s">...</span>
   <span class="na">https.key</span><span class="pi">:</span> <span class="s">...</span>
</pre></table></code></div></div><h4 id="파드에서-시크릿-항목-읽기"><span class="mr-2">파드에서 시크릿 항목 읽기</span><a href="#파드에서-시크릿-항목-읽기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>secret 볼륨을 통해 시크릿을 컨테이너에 노출하면, 시크릿 항목의 값이 일반 텍스트인지 바이너리 데이터인지에 관계 없이 실제 형식으로 디코딩돼 파일에 기록된다.</ul><h3 id="755-파드에서-시크릿-사용"><span class="mr-2">7.5.5 파드에서 시크릿 사용</span><a href="#755-파드에서-시크릿-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>configmap의 nignx 설정에 https 인증서와 개인키를 추가해주고 시크릿을 파드에 마운트<li>참고 : 시크릿도 defaultMode 속성을 통해 볼륨에 노출된 파일 권한을 지정할 수 있음</ul><h4 id="fortune-https-시크릿을-파드에-마운트"><span class="mr-2">fortune-https 시크릿을 파드에 마운트</span><a href="#fortune-https-시크릿을-파드에-마운트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-https</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">luksa/fortune:env</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">html-generator</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">INTERVAL</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">configMapKeyRef</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">sleep-interval</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/htdocs</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">web-server</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/nginx/conf.d</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>                       <span class="c1"># nginx 서버가 인증서와 키를 /etc/nginx/certs에서 읽을수 있도록 해당 위치에 secret 마운트</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/nginx/certs/</span>
      <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">443</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
    <span class="na">configMap</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-config</span>
      <span class="na">items</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">my-nginx-config.conf</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">https.conf</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">certs</span>                       <span class="c1"># 시크릿 볼륨 정의</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">fortune-https</span>
</pre></table></code></div></div><p><a href="https://user-images.githubusercontent.com/6982740/90974768-2434fa80-e569-11ea-8e2d-57792e1aacd2.png" class="popup img-link "><img width="590" alt="스크린샷 2020-08-23 오후 5 50 29" data-src="https://user-images.githubusercontent.com/6982740/90974768-2434fa80-e569-11ea-8e2d-57792e1aacd2.png" class="lazyload" data-proofer-ignore></a></p><h4 id="nginx가-시크릿의-인증서와-키를-사용하는지-테스트"><span class="mr-2">nginx가 시크릿의 인증서와 키를 사용하는지 테스트</span><a href="#nginx가-시크릿의-인증서와-키를-사용하는지-테스트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># https 파드 생성</span>
kubectl create <span class="nt">-f</span> fortune-pod-https.yaml

<span class="c"># port forward</span>
kubectl port-forward fortune-https 8443:443 &amp;

<span class="c"># curl call</span>
curl  https://localhost:8443 <span class="nt">-k</span> <span class="nt">-v</span>
</pre></table></code></div></div><h4 id="시크릿-볼륨을-메모리에-저장하는-이유"><span class="mr-2">시크릿 볼륨을 메모리에 저장하는 이유</span><a href="#시크릿-볼륨을-메모리에-저장하는-이유" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>시크릿 볼륨은 시크릿 파일을 저장하는 데 인메모리 파일시스템(tmpfs)을 사용한다.<li>tmpfs를 사용하는 이유는 민감한 데이터를 노출시킬 수도 있는 디스크에 저장하지 않기 위해서이다.</ul><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># 컨테이너 확인</span>
kubectl <span class="nb">exec </span>fortune-https <span class="nt">-c</span> web-server <span class="nt">--</span> mount | <span class="nb">grep </span>certs

tmpfs on /etc/nginx/certs <span class="nb">type </span>tmpfs <span class="o">(</span>ro,relatime<span class="o">)</span>
</pre></table></code></div></div><h4 id="환경변수로-시크릿-항목-노출"><span class="mr-2">환경변수로 시크릿 항목 노출</span><a href="#환경변수로-시크릿-항목-노출" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>configMapKeyRef 대신 secretKeyRef를 사용해 컨피그맵과 유사한 방식으로 참조가 가능하다.<li>시크릿을 환경변수로 노출할 수 있게 해주기는 하지만, 이 기능 사용은 권장하지는 않는다.<li>앱에서 일반적으로 오류 보고서에 환경변수를 기록하거나 로그에 환경변수를 남겨 의도치 않게 시크릿이 노출될 가능성이 있다.<li>또한 자식 프로세스는 부모 프로세스의 모든 환경변수를 상속받는데, 앱이 타사(third-party) 바이너리를 실행할 경우 시크릿 데이터를 어떻게 사용하는지 알 수 있는 방법이 없다.</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>    <span class="na">env</span><span class="pi">:</span>                               <span class="c1"># 변수는 시크릿 항목에서 설정</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">FOO_SECRET</span>
      <span class="na">valueFrom</span><span class="pi">:</span> <span class="s2">"</span><span class="s">30"</span>
         <span class="na">secretKeyRef</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">fortune-https</span>        <span class="c1"># 시크릿 이름 지정</span>
            <span class="na">key</span><span class="pi">:</span> <span class="s">foo</span>                   <span class="c1"># 시크릿의 키 이름</span>

</pre></table></code></div></div><h3 id="756-이미지를-가져올-때-사용하는-시크릿-이해"><span class="mr-2">7.5.6 이미지를 가져올 때 사용하는 시크릿 이해</span><a href="#756-이미지를-가져올-때-사용하는-시크릿-이해" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>쿠버네티스에서 자격증명을 전달하는것이 필요할때가 있다.(프라이빗 컨테이너 이미지 레지스트리)</ul><h4 id="도커-허브에서-프라이빗-이미지-사용"><span class="mr-2">도커 허브에서 프라이빗 이미지 사용</span><a href="#도커-허브에서-프라이빗-이미지-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>도커 레지스트리 자격증명을 가진 시크릿 생성<li>파드 매니페스트 안에 imagePullSecrets 필드에 해당 시크릿 참조</ul><h4 id="도커-레지스트리-인증을-위한-시크릿-생성"><span class="mr-2">도커 레지스트리 인증을 위한 시크릿 생성</span><a href="#도커-레지스트리-인증을-위한-시크릿-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1"># 도커 레지스트리용 시크릿 생성</span>
<span class="s">kubectl create secret docker-registry mydockerhubsecret --docker-username=myusername --docker-password=mypassword --docker-email=my.email@providercom</span>
</pre></table></code></div></div><h4 id="파드-정의에서-도커-레지스트리-시크릿-사용"><span class="mr-2">파드 정의에서 도커 레지스트리 시크릿 사용</span><a href="#파드-정의에서-도커-레지스트리-시크릿-사용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">private-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">imagePullSecrets</span><span class="pi">:</span>                 <span class="c1"># 프라이빗 이미지 레지스트리에서 이미지를 가져올 수 있도록 설정</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mydockerhubsecret</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">username/private:tag</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">main</span>
</pre></table></code></div></div><h4 id="모든-파드에서-이미지를-가져올-때-사용할-시크릿을-모두-지정할-필요는-없다"><span class="mr-2">모든 파드에서 이미지를 가져올 때 사용할 시크릿을 모두 지정할 필요는 없다.</span><a href="#모든-파드에서-이미지를-가져올-때-사용할-시크릿을-모두-지정할-필요는-없다" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>이미지를 가져올 때 사용할 시크릿을 서비스어카운트에 추가해 모든 파드에 자동으로 추가되도록 할수도 있다.(12장)</ul><h2 id="76-요약"><span class="mr-2">7.6 요약</span><a href="#76-요약" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>컨테이너 이미지에 정의된 기본 명령어를 파드 정의 안에 재정의<li>주 컨테이너 프로세스에 명령줄 인자 전달<li>컨테이너에서 사용할 환경변수 설정<li>파드 사양에서 설정을 분리해 컨피그맵 안에 넣기<li>민감한 데이터를 시크릿 안에 넣고 컨테이너에 안전하게 전달<li>docker-registry 시크릿을 만들고 프라이빗 이미지 레지스트리에서 이미지를 가져올 때 사용</ul><h2 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://www.manning.com/books/kubernetes-in-action">kubernetes-in-action</a><li><a href="https://kubernetes.io/ko/docs/home/">kubernetes.io</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devlog/'>DevLog</a>, <a href='/categories/kubernetes/'>kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/infra/" class="post-tag no-text-decoration" >Infra</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/kubernetes-in-action/" class="post-tag no-text-decoration" >kubernetes-in-action</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[kubernetes-in-action]%207.%20%EC%BB%A8%ED%94%BC%EA%B7%B8%EB%A7%B5%EA%B3%BC%20%EC%8B%9C%ED%81%AC%EB%A6%BF%20:%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%20%EC%84%A4%EC%A0%95%20-%20Sungsu's%20Tech%20Blog&url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fdevlog-platform-kubernetes-in-action7%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[kubernetes-in-action]%207.%20%EC%BB%A8%ED%94%BC%EA%B7%B8%EB%A7%B5%EA%B3%BC%20%EC%8B%9C%ED%81%AC%EB%A6%BF%20:%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%20%EC%84%A4%EC%A0%95%20-%20Sungsu's%20Tech%20Blog&u=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fdevlog-platform-kubernetes-in-action7%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsungsu9022.github.io%2Fposts%2Fdevlog-platform-kubernetes-in-action7%2F&text=[kubernetes-in-action]%207.%20%EC%BB%A8%ED%94%BC%EA%B7%B8%EB%A7%B5%EA%B3%BC%20%EC%8B%9C%ED%81%AC%EB%A6%BF%20:%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%20%EC%84%A4%EC%A0%95%20-%20Sungsu's%20Tech%20Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/es-bible-4-3/">[엘라스틱서치 바이블] 4. 데이터 다루기 -3(ES Client 라이브러리)</a><li><a href="/posts/es-bible-4-2/">[엘라스틱서치 바이블] 4. 데이터 다루기 -2(집계)</a><li><a href="/posts/es-bible-2/">[엘라스틱서치 바이블] 2. 엘라스틱 서치 기본 동작과 구조</a><li><a href="/posts/es-bible-3-1/">[엘라스틱서치 바이블] 3. 인덱스 설계 - 1</a><li><a href="/posts/spark-guide-6/">[스파크 완벽 가이드] 6. 다양한 데이터 타입 다루기</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/devlog-platform-kubernetes-in-action1/"><div class="card-body"> <em class="small" data-ts="1596270840" data-df="ll" > Aug 1, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-in-action] 1. 쿠버네티스 소개</h3><div class="text-muted small"><p> 1. 쿠버네티스 소개 쿠버네티스 등장 배경 거대한 모놀리스 레거시 애플리케이션은 점차 마이크로 서비스라는 독립적으로 실행되는 더 작은 구성 요소로 세분화되고 있다. 마이크로 서비스는 서루 분리돼 있기 떄문에 개별적으로 개발, 배포, 업데이트, 확장할 수 있다. 이로써 오늘날 급변하는 비즈니스 요구사항을 충족시킬 만큼 신속하게 자주 구성 요소를 변...</p></div></div></a></div><div class="card"> <a href="/posts/devlog-platform-kubernetes-in-action2/"><div class="card-body"> <em class="small" data-ts="1596357240" data-df="ll" > Aug 2, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-in-action] 2. 도커와 쿠버네티스 첫걸음</h3><div class="text-muted small"><p> 2. 도커와 쿠버네티스 첫걸음 2.1 도커를 사용한 컨테이너 이미지 생성, 실행, 공유하기 2.1.1 Hello World 컨테이너 실행하기 docker run busybox echp &quot;Hello world&quot; 백그라운드에 일어난 동작 이해하기 docker run 명령을 수행했을 떄 일어나는 일들 2.1.2 간단한 node.js 애플리...</p></div></div></a></div><div class="card"> <a href="/posts/devlog-platform-kubernetes-in-action3/"><div class="card-body"> <em class="small" data-ts="1596443640" data-df="ll" > Aug 3, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[kubernetes-in-action] 3. 파드 : 쿠버네티스에서 컨테이너 실행</h3><div class="text-muted small"><p> 3. 파드 : 쿠버네티스에서 컨테이너 실행 3.1 파드 소개 파드는 함께 배치된 컨테이너 그룹이며, 쿠버네티스의 기본 빌딩 블록. 컨테이너를 개별적으로 배포하기보다는 컨테이너를 가진 파드를 배포하고, 운영한다. 무조건 2개 이상을 컨테이너를 포함시키라는 의미는 아니고 일반적으로는 하나의 컨테이너만 포함된다. 파드의 핵심은 파드가 여러 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/devlog-platform-kubernetes-in-action6/" class="btn btn-outline-primary" prompt="Older"><p>[kubernetes-in-action] 6. 볼륨 : 컨테이너에 디스크 스토리지 연결</p></a> <a href="/posts/devlog-platform-kubernetes-in-action8/" class="btn btn-outline-primary" prompt="Newer"><p>[kubernetes-in-action] 8. 애플리케이션에서 파드 메타데이터와 그 외의 리소스에 엑세스하기</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://sungsu9022.github.io/posts/devlog-platform-kubernetes-in-action7/'; this.page.identifier = '/posts/devlog-platform-kubernetes-in-action7/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://sungsu-parks-tech-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spark/">Spark</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes-in-action/">kubernetes-in-action</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/elasticsearch/">Elasticsearch</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/effective-java/">Effective Java</a> <a class="post-tag" href="/tags/hands-on-reactive-programming-in-spring-5/">Hands-On Reactive Programming in Spring 5</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/sungsu9022dev">sungsu9022</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-145894105-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-145894105-1'); }); </script>
